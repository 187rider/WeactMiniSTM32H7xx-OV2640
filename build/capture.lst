ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 1


   1              		.cpu cortex-m7
   2              		.arch armv7e-m
   3              		.fpu fpv5-d16
   4              		.eabi_attribute 28, 1
   5              		.eabi_attribute 20, 1
   6              		.eabi_attribute 21, 1
   7              		.eabi_attribute 23, 3
   8              		.eabi_attribute 24, 1
   9              		.eabi_attribute 25, 1
  10              		.eabi_attribute 26, 1
  11              		.eabi_attribute 30, 1
  12              		.eabi_attribute 34, 1
  13              		.eabi_attribute 18, 4
  14              		.file	"capture.c"
  15              		.text
  16              	.Ltext0:
  17              		.cfi_sections	.debug_frame
  18              		.file 1 "Src/capture.c"
  19              		.section	.text.to_lower,"ax",%progbits
  20              		.align	1
  21              		.syntax unified
  22              		.thumb
  23              		.thumb_func
  25              	to_lower:
  26              	.LVL0:
  27              	.LFB147:
   1:Src/capture.c **** #include "fatfs.h"
   2:Src/capture.c **** #include "stdio.h"
   3:Src/capture.c **** #include "string.h"
   4:Src/capture.c **** #include "main.h"
   5:Src/capture.c **** #include "i2c.h"
   6:Src/capture.c **** #include "camera.h"
   7:Src/capture.c **** #include "lcd.h"
   8:Src/capture.c **** 
   9:Src/capture.c **** extern uint32_t photo_id;
  10:Src/capture.c **** extern volatile uint32_t DCMI_FrameIsReady;
  11:Src/capture.c **** extern volatile uint32_t DCMI_VsyncFlag;
  12:Src/capture.c **** extern volatile uint32_t DCMI_CallbackCount;
  13:Src/capture.c **** 
  14:Src/capture.c **** // JPEG capture buffer - single snapshot mode
  15:Src/capture.c **** #define JPEG_BUFFER_SIZE   (448*1024)  // 448KB buffer for JPEG snapshot
  16:Src/capture.c **** #define JPEG_BUFFER_WORDS  (JPEG_BUFFER_SIZE/4)
  17:Src/capture.c **** __attribute__((section(".sram1"))) static uint8_t jpeg_buffer[JPEG_BUFFER_SIZE];
  18:Src/capture.c **** 
  19:Src/capture.c **** // Timeout constants
  20:Src/capture.c **** #define VSYNC_TIMEOUT_MS    1000
  21:Src/capture.c **** #define FRAME_TIMEOUT_MS    4000
  22:Src/capture.c **** #define DELAY_STEP_MS       10
  23:Src/capture.c **** 
  24:Src/capture.c **** // File naming constants
  25:Src/capture.c **** #define MAX_PHOTO_ID        100000
  26:Src/capture.c **** #define MAX_FILENAME_ATTEMPTS 1000
  27:Src/capture.c **** 
  28:Src/capture.c **** // Helper: convert char to lowercase
  29:Src/capture.c **** static char to_lower(char c)
  30:Src/capture.c **** {
  28              		.loc 1 30 1 view -0
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 2


  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 0
  31              		@ frame_needed = 0, uses_anonymous_args = 0
  32              		@ link register save eliminated.
  31:Src/capture.c ****     return (c >= 'A' && c <= 'Z') ? (char)(c + 32) : c;
  33              		.loc 1 31 5 view .LVU1
  34              		.loc 1 31 22 is_stmt 0 view .LVU2
  35 0000 A0F14103 		sub	r3, r0, #65
  36 0004 DBB2     		uxtb	r3, r3
  37              		.loc 1 31 52 view .LVU3
  38 0006 192B     		cmp	r3, #25
  39 0008 01D8     		bhi	.L2
  40              		.loc 1 31 52 discriminator 1 view .LVU4
  41 000a 2030     		adds	r0, r0, #32
  42              	.LVL1:
  43              		.loc 1 31 52 discriminator 1 view .LVU5
  44 000c C0B2     		uxtb	r0, r0
  45              	.LVL2:
  46              	.L2:
  32:Src/capture.c **** }
  47              		.loc 1 32 1 view .LVU6
  48 000e 7047     		bx	lr
  49              		.cfi_endproc
  50              	.LFE147:
  52              		.section	.rodata.ensure_sd_mounted.str1.4,"aMS",%progbits,1
  53              		.align	2
  54              	.LC0:
  55 0000 5344206D 		.ascii	"SD mount err:%d\000"
  55      6F756E74 
  55      20657272 
  55      3A256400 
  56              		.section	.text.ensure_sd_mounted,"ax",%progbits
  57              		.align	1
  58              		.syntax unified
  59              		.thumb
  60              		.thumb_func
  62              	ensure_sd_mounted:
  63              	.LFB150:
  33:Src/capture.c **** 
  34:Src/capture.c **** // Parse photo ID from filename (PHOTO_12345.jpeg or P12345.JPG)
  35:Src/capture.c **** static int parse_photo_id(const char *name, uint32_t *id_out)
  36:Src/capture.c **** {
  37:Src/capture.c ****     const char *dot = strrchr(name, '.');
  38:Src/capture.c ****     if (!dot) return 0;
  39:Src/capture.c ****     
  40:Src/capture.c ****     // Check for .jpeg or .jpg extension (case insensitive)
  41:Src/capture.c ****     int is_jpeg = (to_lower(dot[1]) == 'j' && to_lower(dot[2]) == 'p' && 
  42:Src/capture.c ****                    to_lower(dot[3]) == 'e' && to_lower(dot[4]) == 'g' && dot[5] == '\0');
  43:Src/capture.c ****     int is_jpg = (to_lower(dot[1]) == 'j' && to_lower(dot[2]) == 'p' && 
  44:Src/capture.c ****                   to_lower(dot[3]) == 'g' && dot[4] == '\0');
  45:Src/capture.c ****     
  46:Src/capture.c ****     if (!is_jpeg && !is_jpg) return 0;
  47:Src/capture.c ****     
  48:Src/capture.c ****     // Check for PHOTO_ or P prefix
  49:Src/capture.c ****     const char *p;
  50:Src/capture.c ****     if (strncmp(name, "PHOTO_", 6) == 0 || strncmp(name, "photo_", 6) == 0) {
  51:Src/capture.c ****         p = name + 6;
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 3


  52:Src/capture.c ****     } else if (name[0] == 'P' || name[0] == 'p') {
  53:Src/capture.c ****         p = name + 1;
  54:Src/capture.c ****     } else {
  55:Src/capture.c ****         return 0;
  56:Src/capture.c ****     }
  57:Src/capture.c ****     
  58:Src/capture.c ****     if (p >= dot) return 0;
  59:Src/capture.c ****     
  60:Src/capture.c ****     // Parse numeric ID
  61:Src/capture.c ****     uint32_t id = 0;
  62:Src/capture.c ****     while (p < dot) {
  63:Src/capture.c ****         if (*p < '0' || *p > '9') return 0;
  64:Src/capture.c ****         id = id * 10 + (uint32_t)(*p - '0');
  65:Src/capture.c ****         p++;
  66:Src/capture.c ****     }
  67:Src/capture.c ****     
  68:Src/capture.c ****     *id_out = id;
  69:Src/capture.c ****     return 1;
  70:Src/capture.c **** }
  71:Src/capture.c **** 
  72:Src/capture.c **** // Find next available photo ID by scanning SD card
  73:Src/capture.c **** static uint32_t find_next_photo_id(void)
  74:Src/capture.c **** {
  75:Src/capture.c ****     DIR dir;
  76:Src/capture.c ****     FILINFO finfo;
  77:Src/capture.c ****     uint32_t max_id = 0;
  78:Src/capture.c ****     
  79:Src/capture.c ****     if (f_opendir(&dir, "/") == FR_OK) {
  80:Src/capture.c ****         while (f_readdir(&dir, &finfo) == FR_OK && finfo.fname[0]) {
  81:Src/capture.c ****             uint32_t id = 0;
  82:Src/capture.c ****             if (parse_photo_id(finfo.fname, &id) && id >= max_id) {
  83:Src/capture.c ****                 max_id = id + 1;
  84:Src/capture.c ****             }
  85:Src/capture.c ****         }
  86:Src/capture.c ****         f_closedir(&dir);
  87:Src/capture.c ****     }
  88:Src/capture.c ****     
  89:Src/capture.c ****     return max_id % MAX_PHOTO_ID;
  90:Src/capture.c **** }
  91:Src/capture.c **** 
  92:Src/capture.c **** // Ensure SD card is mounted
  93:Src/capture.c **** static int ensure_sd_mounted(void)
  94:Src/capture.c **** {
  64              		.loc 1 94 1 is_stmt 1 view -0
  65              		.cfi_startproc
  66              		@ args = 0, pretend = 0, frame = 32
  67              		@ frame_needed = 0, uses_anonymous_args = 0
  95:Src/capture.c ****     if (SDFatFS.fs_type != 0) {
  68              		.loc 1 95 5 view .LVU8
  69              		.loc 1 95 16 is_stmt 0 view .LVU9
  70 0000 114B     		ldr	r3, .L13
  71 0002 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
  72              		.loc 1 95 8 view .LVU10
  73 0004 0BB1     		cbz	r3, .L11
  96:Src/capture.c ****         return 1; // Already mounted
  74              		.loc 1 96 16 view .LVU11
  75 0006 0120     		movs	r0, #1
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 4


  97:Src/capture.c ****     }
  98:Src/capture.c ****     
  99:Src/capture.c ****     FRESULT res = f_mount(&SDFatFS, SDPath, 1);
 100:Src/capture.c ****     if (res != FR_OK) {
 101:Src/capture.c ****         char msg[32];
 102:Src/capture.c ****         snprintf(msg, sizeof(msg), "SD mount err:%d", res);
 103:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)msg);
 104:Src/capture.c ****         return 0;
 105:Src/capture.c ****     }
 106:Src/capture.c ****     
 107:Src/capture.c ****     return 1;
 108:Src/capture.c **** }
  76              		.loc 1 108 1 view .LVU12
  77 0008 7047     		bx	lr
  78              	.L11:
  94:Src/capture.c ****     if (SDFatFS.fs_type != 0) {
  79              		.loc 1 94 1 view .LVU13
  80 000a 10B5     		push	{r4, lr}
  81              	.LCFI0:
  82              		.cfi_def_cfa_offset 8
  83              		.cfi_offset 4, -8
  84              		.cfi_offset 14, -4
  85 000c 8AB0     		sub	sp, sp, #40
  86              	.LCFI1:
  87              		.cfi_def_cfa_offset 48
  99:Src/capture.c ****     if (res != FR_OK) {
  88              		.loc 1 99 5 is_stmt 1 view .LVU14
  99:Src/capture.c ****     if (res != FR_OK) {
  89              		.loc 1 99 19 is_stmt 0 view .LVU15
  90 000e 0122     		movs	r2, #1
  91 0010 0E49     		ldr	r1, .L13+4
  92 0012 0D48     		ldr	r0, .L13
  93 0014 FFF7FEFF 		bl	f_mount
  94              	.LVL3:
 100:Src/capture.c ****         char msg[32];
  95              		.loc 1 100 5 is_stmt 1 view .LVU16
 100:Src/capture.c ****         char msg[32];
  96              		.loc 1 100 8 is_stmt 0 view .LVU17
  97 0018 0346     		mov	r3, r0
  98 001a 10B9     		cbnz	r0, .L12
 107:Src/capture.c **** }
  99              		.loc 1 107 12 view .LVU18
 100 001c 0120     		movs	r0, #1
 101              	.LVL4:
 102              	.L3:
 103              		.loc 1 108 1 view .LVU19
 104 001e 0AB0     		add	sp, sp, #40
 105              	.LCFI2:
 106              		.cfi_remember_state
 107              		.cfi_def_cfa_offset 8
 108              		@ sp needed
 109 0020 10BD     		pop	{r4, pc}
 110              	.LVL5:
 111              	.L12:
 112              	.LCFI3:
 113              		.cfi_restore_state
 114              	.LBB2:
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 5


 101:Src/capture.c ****         snprintf(msg, sizeof(msg), "SD mount err:%d", res);
 115              		.loc 1 101 9 is_stmt 1 view .LVU20
 102:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)msg);
 116              		.loc 1 102 9 view .LVU21
 117 0022 02AC     		add	r4, sp, #8
 118 0024 0A4A     		ldr	r2, .L13+8
 119 0026 2021     		movs	r1, #32
 120 0028 2046     		mov	r0, r4
 121              	.LVL6:
 102:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)msg);
 122              		.loc 1 102 9 is_stmt 0 view .LVU22
 123 002a FFF7FEFF 		bl	snprintf
 124              	.LVL7:
 103:Src/capture.c ****         return 0;
 125              		.loc 1 103 9 is_stmt 1 view .LVU23
 126 002e 0194     		str	r4, [sp, #4]
 127 0030 0C23     		movs	r3, #12
 128 0032 0093     		str	r3, [sp]
 129 0034 0523     		movs	r3, #5
 130 0036 074A     		ldr	r2, .L13+12
 131 0038 1288     		ldrh	r2, [r2]
 132 003a 3221     		movs	r1, #50
 133 003c 0020     		movs	r0, #0
 134 003e FFF7FEFF 		bl	LCD_ShowString
 135              	.LVL8:
 104:Src/capture.c ****     }
 136              		.loc 1 104 9 view .LVU24
 104:Src/capture.c ****     }
 137              		.loc 1 104 16 is_stmt 0 view .LVU25
 138 0042 0020     		movs	r0, #0
 139 0044 EBE7     		b	.L3
 140              	.L14:
 141 0046 00BF     		.align	2
 142              	.L13:
 143 0048 00000000 		.word	SDFatFS
 144 004c 00000000 		.word	SDPath
 145 0050 00000000 		.word	.LC0
 146 0054 00000000 		.word	ST7735Ctx
 147              	.LBE2:
 148              		.cfi_endproc
 149              	.LFE150:
 151              		.section	.rodata.parse_photo_id.str1.4,"aMS",%progbits,1
 152              		.align	2
 153              	.LC1:
 154 0000 50484F54 		.ascii	"PHOTO_\000"
 154      4F5F00
 155 0007 00       		.align	2
 156              	.LC2:
 157 0008 70686F74 		.ascii	"photo_\000"
 157      6F5F00
 158              		.section	.text.parse_photo_id,"ax",%progbits
 159              		.align	1
 160              		.syntax unified
 161              		.thumb
 162              		.thumb_func
 164              	parse_photo_id:
 165              	.LVL9:
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 6


 166              	.LFB148:
  36:Src/capture.c ****     const char *dot = strrchr(name, '.');
 167              		.loc 1 36 1 is_stmt 1 view -0
 168              		.cfi_startproc
 169              		@ args = 0, pretend = 0, frame = 0
 170              		@ frame_needed = 0, uses_anonymous_args = 0
  36:Src/capture.c ****     const char *dot = strrchr(name, '.');
 171              		.loc 1 36 1 is_stmt 0 view .LVU27
 172 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 173              	.LCFI4:
 174              		.cfi_def_cfa_offset 24
 175              		.cfi_offset 4, -24
 176              		.cfi_offset 5, -20
 177              		.cfi_offset 6, -16
 178              		.cfi_offset 7, -12
 179              		.cfi_offset 8, -8
 180              		.cfi_offset 14, -4
 181 0004 0446     		mov	r4, r0
 182 0006 0E46     		mov	r6, r1
  37:Src/capture.c ****     if (!dot) return 0;
 183              		.loc 1 37 5 is_stmt 1 view .LVU28
  37:Src/capture.c ****     if (!dot) return 0;
 184              		.loc 1 37 23 is_stmt 0 view .LVU29
 185 0008 2E21     		movs	r1, #46
 186              	.LVL10:
  37:Src/capture.c ****     if (!dot) return 0;
 187              		.loc 1 37 23 view .LVU30
 188 000a FFF7FEFF 		bl	strrchr
 189              	.LVL11:
  38:Src/capture.c ****     
 190              		.loc 1 38 5 is_stmt 1 view .LVU31
  38:Src/capture.c ****     
 191              		.loc 1 38 8 is_stmt 0 view .LVU32
 192 000e 0028     		cmp	r0, #0
 193 0010 69D0     		beq	.L24
 194 0012 0546     		mov	r5, r0
  41:Src/capture.c ****                    to_lower(dot[3]) == 'e' && to_lower(dot[4]) == 'g' && dot[5] == '\0');
 195              		.loc 1 41 5 is_stmt 1 view .LVU33
  41:Src/capture.c ****                    to_lower(dot[3]) == 'e' && to_lower(dot[4]) == 'g' && dot[5] == '\0');
 196              		.loc 1 41 20 is_stmt 0 view .LVU34
 197 0014 4078     		ldrb	r0, [r0, #1]	@ zero_extendqisi2
 198              	.LVL12:
  41:Src/capture.c ****                    to_lower(dot[3]) == 'e' && to_lower(dot[4]) == 'g' && dot[5] == '\0');
 199              		.loc 1 41 20 view .LVU35
 200 0016 FFF7FEFF 		bl	to_lower
 201              	.LVL13:
 202 001a 8046     		mov	r8, r0
  42:Src/capture.c ****     int is_jpg = (to_lower(dot[1]) == 'j' && to_lower(dot[2]) == 'p' && 
 203              		.loc 1 42 71 view .LVU36
 204 001c 6A28     		cmp	r0, #106
 205 001e 18D0     		beq	.L38
  42:Src/capture.c ****     int is_jpg = (to_lower(dot[1]) == 'j' && to_lower(dot[2]) == 'p' && 
 206              		.loc 1 42 71 discriminator 5 view .LVU37
 207 0020 0027     		movs	r7, #0
 208              	.L17:
 209              	.LVL14:
  43:Src/capture.c ****                   to_lower(dot[3]) == 'g' && dot[4] == '\0');
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 7


 210              		.loc 1 43 5 is_stmt 1 view .LVU38
  44:Src/capture.c ****     
 211              		.loc 1 44 43 is_stmt 0 view .LVU39
 212 0022 B8F16A0F 		cmp	r8, #106
 213 0026 2FD0     		beq	.L39
  44:Src/capture.c ****     
 214              		.loc 1 44 43 discriminator 1 view .LVU40
 215 0028 0023     		movs	r3, #0
 216              	.L18:
 217              	.LVL15:
  46:Src/capture.c ****     
 218              		.loc 1 46 5 is_stmt 1 view .LVU41
  46:Src/capture.c ****     
 219              		.loc 1 46 8 is_stmt 0 view .LVU42
 220 002a 57EA0300 		orrs	r0, r7, r3
 221 002e 5BD0     		beq	.L15
  49:Src/capture.c ****     if (strncmp(name, "PHOTO_", 6) == 0 || strncmp(name, "photo_", 6) == 0) {
 222              		.loc 1 49 5 is_stmt 1 view .LVU43
  50:Src/capture.c ****         p = name + 6;
 223              		.loc 1 50 5 view .LVU44
  50:Src/capture.c ****         p = name + 6;
 224              		.loc 1 50 9 is_stmt 0 view .LVU45
 225 0030 0622     		movs	r2, #6
 226 0032 3049     		ldr	r1, .L47
 227 0034 2046     		mov	r0, r4
 228 0036 FFF7FEFF 		bl	strncmp
 229              	.LVL16:
  50:Src/capture.c ****         p = name + 6;
 230              		.loc 1 50 8 discriminator 1 view .LVU46
 231 003a 28B1     		cbz	r0, .L19
  50:Src/capture.c ****         p = name + 6;
 232              		.loc 1 50 44 discriminator 1 view .LVU47
 233 003c 0622     		movs	r2, #6
 234 003e 2E49     		ldr	r1, .L47+4
 235 0040 2046     		mov	r0, r4
 236 0042 FFF7FEFF 		bl	strncmp
 237              	.LVL17:
  50:Src/capture.c ****         p = name + 6;
 238              		.loc 1 50 41 discriminator 1 view .LVU48
 239 0046 98BB     		cbnz	r0, .L20
 240              	.L19:
  51:Src/capture.c ****     } else if (name[0] == 'P' || name[0] == 'p') {
 241              		.loc 1 51 9 is_stmt 1 view .LVU49
  51:Src/capture.c ****     } else if (name[0] == 'P' || name[0] == 'p') {
 242              		.loc 1 51 11 is_stmt 0 view .LVU50
 243 0048 A01D     		adds	r0, r4, #6
 244              	.LVL18:
 245              	.L21:
  58:Src/capture.c ****     
 246              		.loc 1 58 5 is_stmt 1 view .LVU51
  58:Src/capture.c ****     
 247              		.loc 1 58 8 is_stmt 0 view .LVU52
 248 004a A842     		cmp	r0, r5
 249 004c 50D2     		bcs	.L35
  61:Src/capture.c ****     while (p < dot) {
 250              		.loc 1 61 14 view .LVU53
 251 004e 0023     		movs	r3, #0
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 8


 252 0050 3CE0     		b	.L22
 253              	.LVL19:
 254              	.L38:
  41:Src/capture.c ****                    to_lower(dot[3]) == 'e' && to_lower(dot[4]) == 'g' && dot[5] == '\0');
 255              		.loc 1 41 47 view .LVU54
 256 0052 A878     		ldrb	r0, [r5, #2]	@ zero_extendqisi2
 257 0054 FFF7FEFF 		bl	to_lower
 258              	.LVL20:
  41:Src/capture.c ****                    to_lower(dot[3]) == 'e' && to_lower(dot[4]) == 'g' && dot[5] == '\0');
 259              		.loc 1 41 44 discriminator 1 view .LVU55
 260 0058 7028     		cmp	r0, #112
 261 005a 01D0     		beq	.L40
  42:Src/capture.c ****     int is_jpg = (to_lower(dot[1]) == 'j' && to_lower(dot[2]) == 'p' && 
 262              		.loc 1 42 71 discriminator 5 view .LVU56
 263 005c 0027     		movs	r7, #0
 264 005e E0E7     		b	.L17
 265              	.L40:
  42:Src/capture.c ****     int is_jpg = (to_lower(dot[1]) == 'j' && to_lower(dot[2]) == 'p' && 
 266              		.loc 1 42 20 view .LVU57
 267 0060 E878     		ldrb	r0, [r5, #3]	@ zero_extendqisi2
 268 0062 FFF7FEFF 		bl	to_lower
 269              	.LVL21:
  41:Src/capture.c ****                    to_lower(dot[3]) == 'e' && to_lower(dot[4]) == 'g' && dot[5] == '\0');
 270              		.loc 1 41 71 discriminator 1 view .LVU58
 271 0066 6528     		cmp	r0, #101
 272 0068 01D0     		beq	.L41
  42:Src/capture.c ****     int is_jpg = (to_lower(dot[1]) == 'j' && to_lower(dot[2]) == 'p' && 
 273              		.loc 1 42 71 discriminator 5 view .LVU59
 274 006a 0027     		movs	r7, #0
 275 006c D9E7     		b	.L17
 276              	.L41:
  42:Src/capture.c ****     int is_jpg = (to_lower(dot[1]) == 'j' && to_lower(dot[2]) == 'p' && 
 277              		.loc 1 42 47 view .LVU60
 278 006e 2879     		ldrb	r0, [r5, #4]	@ zero_extendqisi2
 279 0070 FFF7FEFF 		bl	to_lower
 280              	.LVL22:
  42:Src/capture.c ****     int is_jpg = (to_lower(dot[1]) == 'j' && to_lower(dot[2]) == 'p' && 
 281              		.loc 1 42 44 discriminator 1 view .LVU61
 282 0074 6728     		cmp	r0, #103
 283 0076 01D0     		beq	.L42
  42:Src/capture.c ****     int is_jpg = (to_lower(dot[1]) == 'j' && to_lower(dot[2]) == 'p' && 
 284              		.loc 1 42 71 discriminator 5 view .LVU62
 285 0078 0027     		movs	r7, #0
 286 007a D2E7     		b	.L17
 287              	.L42:
  42:Src/capture.c ****     int is_jpg = (to_lower(dot[1]) == 'j' && to_lower(dot[2]) == 'p' && 
 288              		.loc 1 42 77 discriminator 2 view .LVU63
 289 007c 6B79     		ldrb	r3, [r5, #5]	@ zero_extendqisi2
  42:Src/capture.c ****     int is_jpg = (to_lower(dot[1]) == 'j' && to_lower(dot[2]) == 'p' && 
 290              		.loc 1 42 71 discriminator 2 view .LVU64
 291 007e 0BB9     		cbnz	r3, .L29
  42:Src/capture.c ****     int is_jpg = (to_lower(dot[1]) == 'j' && to_lower(dot[2]) == 'p' && 
 292              		.loc 1 42 71 discriminator 4 view .LVU65
 293 0080 0127     		movs	r7, #1
 294 0082 CEE7     		b	.L17
 295              	.L29:
  42:Src/capture.c ****     int is_jpg = (to_lower(dot[1]) == 'j' && to_lower(dot[2]) == 'p' && 
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 9


 296              		.loc 1 42 71 discriminator 5 view .LVU66
 297 0084 0027     		movs	r7, #0
 298 0086 CCE7     		b	.L17
 299              	.LVL23:
 300              	.L39:
  43:Src/capture.c ****                   to_lower(dot[3]) == 'g' && dot[4] == '\0');
 301              		.loc 1 43 46 view .LVU67
 302 0088 A878     		ldrb	r0, [r5, #2]	@ zero_extendqisi2
 303 008a FFF7FEFF 		bl	to_lower
 304              	.LVL24:
  43:Src/capture.c ****                   to_lower(dot[3]) == 'g' && dot[4] == '\0');
 305              		.loc 1 43 43 discriminator 1 view .LVU68
 306 008e 7028     		cmp	r0, #112
 307 0090 01D0     		beq	.L43
  44:Src/capture.c ****     
 308              		.loc 1 44 43 discriminator 1 view .LVU69
 309 0092 0023     		movs	r3, #0
 310 0094 C9E7     		b	.L18
 311              	.L43:
  44:Src/capture.c ****     
 312              		.loc 1 44 19 view .LVU70
 313 0096 E878     		ldrb	r0, [r5, #3]	@ zero_extendqisi2
 314 0098 FFF7FEFF 		bl	to_lower
 315              	.LVL25:
  43:Src/capture.c ****                   to_lower(dot[3]) == 'g' && dot[4] == '\0');
 316              		.loc 1 43 70 discriminator 1 view .LVU71
 317 009c 6728     		cmp	r0, #103
 318 009e 01D0     		beq	.L44
  44:Src/capture.c ****     
 319              		.loc 1 44 43 discriminator 1 view .LVU72
 320 00a0 0023     		movs	r3, #0
 321 00a2 C2E7     		b	.L18
 322              	.L44:
  44:Src/capture.c ****     
 323              		.loc 1 44 49 discriminator 3 view .LVU73
 324 00a4 2B79     		ldrb	r3, [r5, #4]	@ zero_extendqisi2
  44:Src/capture.c ****     
 325              		.loc 1 44 43 discriminator 3 view .LVU74
 326 00a6 0BB9     		cbnz	r3, .L33
  44:Src/capture.c ****     
 327              		.loc 1 44 43 discriminator 2 view .LVU75
 328 00a8 0123     		movs	r3, #1
 329 00aa BEE7     		b	.L18
 330              	.L33:
  44:Src/capture.c ****     
 331              		.loc 1 44 43 discriminator 1 view .LVU76
 332 00ac 0023     		movs	r3, #0
 333 00ae BCE7     		b	.L18
 334              	.LVL26:
 335              	.L20:
  52:Src/capture.c ****         p = name + 1;
 336              		.loc 1 52 12 is_stmt 1 view .LVU77
  52:Src/capture.c ****         p = name + 1;
 337              		.loc 1 52 20 is_stmt 0 view .LVU78
 338 00b0 2378     		ldrb	r3, [r4]	@ zero_extendqisi2
  52:Src/capture.c ****         p = name + 1;
 339              		.loc 1 52 15 view .LVU79
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 10


 340 00b2 702B     		cmp	r3, #112
 341 00b4 18BF     		it	ne
 342 00b6 502B     		cmpne	r3, #80
 343 00b8 18D1     		bne	.L34
  53:Src/capture.c ****     } else {
 344              		.loc 1 53 9 is_stmt 1 view .LVU80
  53:Src/capture.c ****     } else {
 345              		.loc 1 53 11 is_stmt 0 view .LVU81
 346 00ba 601C     		adds	r0, r4, #1
 347              	.LVL27:
  53:Src/capture.c ****     } else {
 348              		.loc 1 53 11 view .LVU82
 349 00bc C5E7     		b	.L21
 350              	.LVL28:
 351              	.L46:
  64:Src/capture.c ****         p++;
 352              		.loc 1 64 9 is_stmt 1 view .LVU83
  64:Src/capture.c ****         p++;
 353              		.loc 1 64 17 is_stmt 0 view .LVU84
 354 00be 03EB8303 		add	r3, r3, r3, lsl #2
 355              	.LVL29:
  64:Src/capture.c ****         p++;
 356              		.loc 1 64 22 view .LVU85
 357 00c2 02EB4302 		add	r2, r2, r3, lsl #1
  64:Src/capture.c ****         p++;
 358              		.loc 1 64 12 view .LVU86
 359 00c6 A2F13003 		sub	r3, r2, #48
 360              	.LVL30:
  65:Src/capture.c ****     }
 361              		.loc 1 65 9 is_stmt 1 view .LVU87
  65:Src/capture.c ****     }
 362              		.loc 1 65 10 is_stmt 0 view .LVU88
 363 00ca 0130     		adds	r0, r0, #1
 364              	.LVL31:
 365              	.L22:
  62:Src/capture.c ****         if (*p < '0' || *p > '9') return 0;
 366              		.loc 1 62 14 is_stmt 1 view .LVU89
 367 00cc A842     		cmp	r0, r5
 368 00ce 07D2     		bcs	.L45
  63:Src/capture.c ****         id = id * 10 + (uint32_t)(*p - '0');
 369              		.loc 1 63 9 view .LVU90
  63:Src/capture.c ****         id = id * 10 + (uint32_t)(*p - '0');
 370              		.loc 1 63 13 is_stmt 0 view .LVU91
 371 00d0 0278     		ldrb	r2, [r0]	@ zero_extendqisi2
  63:Src/capture.c ****         id = id * 10 + (uint32_t)(*p - '0');
 372              		.loc 1 63 22 view .LVU92
 373 00d2 A2F13001 		sub	r1, r2, #48
 374 00d6 C9B2     		uxtb	r1, r1
  63:Src/capture.c ****         id = id * 10 + (uint32_t)(*p - '0');
 375              		.loc 1 63 12 view .LVU93
 376 00d8 0929     		cmp	r1, #9
 377 00da F0D9     		bls	.L46
  63:Src/capture.c ****         id = id * 10 + (uint32_t)(*p - '0');
 378              		.loc 1 63 42 discriminator 1 view .LVU94
 379 00dc 0020     		movs	r0, #0
 380              	.LVL32:
  63:Src/capture.c ****         id = id * 10 + (uint32_t)(*p - '0');
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 11


 381              		.loc 1 63 42 discriminator 1 view .LVU95
 382 00de 03E0     		b	.L15
 383              	.LVL33:
 384              	.L45:
  68:Src/capture.c ****     return 1;
 385              		.loc 1 68 5 is_stmt 1 view .LVU96
  68:Src/capture.c ****     return 1;
 386              		.loc 1 68 13 is_stmt 0 view .LVU97
 387 00e0 3360     		str	r3, [r6]
  69:Src/capture.c **** }
 388              		.loc 1 69 5 is_stmt 1 view .LVU98
  69:Src/capture.c **** }
 389              		.loc 1 69 12 is_stmt 0 view .LVU99
 390 00e2 0120     		movs	r0, #1
 391              	.LVL34:
  69:Src/capture.c **** }
 392              		.loc 1 69 12 view .LVU100
 393 00e4 00E0     		b	.L15
 394              	.LVL35:
 395              	.L24:
  38:Src/capture.c ****     
 396              		.loc 1 38 22 discriminator 1 view .LVU101
 397 00e6 0020     		movs	r0, #0
 398              	.LVL36:
 399              	.L15:
  70:Src/capture.c **** 
 400              		.loc 1 70 1 view .LVU102
 401 00e8 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 402              	.LVL37:
 403              	.L34:
  55:Src/capture.c ****     }
 404              		.loc 1 55 16 view .LVU103
 405 00ec 0020     		movs	r0, #0
 406 00ee FBE7     		b	.L15
 407              	.LVL38:
 408              	.L35:
  58:Src/capture.c ****     
 409              		.loc 1 58 26 discriminator 1 view .LVU104
 410 00f0 0020     		movs	r0, #0
 411              	.LVL39:
  58:Src/capture.c ****     
 412              		.loc 1 58 26 discriminator 1 view .LVU105
 413 00f2 F9E7     		b	.L15
 414              	.L48:
 415              		.align	2
 416              	.L47:
 417 00f4 00000000 		.word	.LC1
 418 00f8 08000000 		.word	.LC2
 419              		.cfi_endproc
 420              	.LFE148:
 422              		.section	.rodata.find_next_photo_id.str1.4,"aMS",%progbits,1
 423              		.align	2
 424              	.LC3:
 425 0000 2F00     		.ascii	"/\000"
 426              		.section	.text.find_next_photo_id,"ax",%progbits
 427              		.align	1
 428              		.syntax unified
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 12


 429              		.thumb
 430              		.thumb_func
 432              	find_next_photo_id:
 433              	.LFB149:
  74:Src/capture.c ****     DIR dir;
 434              		.loc 1 74 1 is_stmt 1 view -0
 435              		.cfi_startproc
 436              		@ args = 0, pretend = 0, frame = 80
 437              		@ frame_needed = 0, uses_anonymous_args = 0
 438 0000 10B5     		push	{r4, lr}
 439              	.LCFI5:
 440              		.cfi_def_cfa_offset 8
 441              		.cfi_offset 4, -8
 442              		.cfi_offset 14, -4
 443 0002 94B0     		sub	sp, sp, #80
 444              	.LCFI6:
 445              		.cfi_def_cfa_offset 88
  75:Src/capture.c ****     FILINFO finfo;
 446              		.loc 1 75 5 view .LVU107
  76:Src/capture.c ****     uint32_t max_id = 0;
 447              		.loc 1 76 5 view .LVU108
  77:Src/capture.c ****     
 448              		.loc 1 77 5 view .LVU109
 449              	.LVL40:
  79:Src/capture.c ****         while (f_readdir(&dir, &finfo) == FR_OK && finfo.fname[0]) {
 450              		.loc 1 79 5 view .LVU110
  79:Src/capture.c ****         while (f_readdir(&dir, &finfo) == FR_OK && finfo.fname[0]) {
 451              		.loc 1 79 9 is_stmt 0 view .LVU111
 452 0004 1549     		ldr	r1, .L57
 453 0006 08A8     		add	r0, sp, #32
 454 0008 FFF7FEFF 		bl	f_opendir
 455              	.LVL41:
  79:Src/capture.c ****         while (f_readdir(&dir, &finfo) == FR_OK && finfo.fname[0]) {
 456              		.loc 1 79 8 discriminator 1 view .LVU112
 457 000c 08B1     		cbz	r0, .L55
  77:Src/capture.c ****     
 458              		.loc 1 77 14 view .LVU113
 459 000e 0024     		movs	r4, #0
 460 0010 19E0     		b	.L51
 461              	.L55:
 462 0012 0024     		movs	r4, #0
 463              	.LVL42:
 464              	.L50:
  80:Src/capture.c ****             uint32_t id = 0;
 465              		.loc 1 80 49 is_stmt 1 view .LVU114
  80:Src/capture.c ****             uint32_t id = 0;
 466              		.loc 1 80 16 is_stmt 0 view .LVU115
 467 0014 02A9     		add	r1, sp, #8
 468 0016 08A8     		add	r0, sp, #32
 469 0018 FFF7FEFF 		bl	f_readdir
 470              	.LVL43:
  80:Src/capture.c ****             uint32_t id = 0;
 471              		.loc 1 80 49 discriminator 1 view .LVU116
 472 001c 80B9     		cbnz	r0, .L53
  80:Src/capture.c ****             uint32_t id = 0;
 473              		.loc 1 80 63 discriminator 1 view .LVU117
 474 001e 9DF81130 		ldrb	r3, [sp, #17]	@ zero_extendqisi2
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 13


  80:Src/capture.c ****             uint32_t id = 0;
 475              		.loc 1 80 49 discriminator 1 view .LVU118
 476 0022 6BB1     		cbz	r3, .L53
 477              	.LBB3:
  81:Src/capture.c ****             if (parse_photo_id(finfo.fname, &id) && id >= max_id) {
 478              		.loc 1 81 13 is_stmt 1 view .LVU119
  81:Src/capture.c ****             if (parse_photo_id(finfo.fname, &id) && id >= max_id) {
 479              		.loc 1 81 22 is_stmt 0 view .LVU120
 480 0024 0023     		movs	r3, #0
 481 0026 0193     		str	r3, [sp, #4]
  82:Src/capture.c ****                 max_id = id + 1;
 482              		.loc 1 82 13 is_stmt 1 view .LVU121
  82:Src/capture.c ****                 max_id = id + 1;
 483              		.loc 1 82 17 is_stmt 0 view .LVU122
 484 0028 01A9     		add	r1, sp, #4
 485 002a 0DF11100 		add	r0, sp, #17
 486 002e FFF7FEFF 		bl	parse_photo_id
 487              	.LVL44:
  82:Src/capture.c ****                 max_id = id + 1;
 488              		.loc 1 82 16 discriminator 1 view .LVU123
 489 0032 0028     		cmp	r0, #0
 490 0034 EED0     		beq	.L50
  82:Src/capture.c ****                 max_id = id + 1;
 491              		.loc 1 82 56 discriminator 1 view .LVU124
 492 0036 019B     		ldr	r3, [sp, #4]
  82:Src/capture.c ****                 max_id = id + 1;
 493              		.loc 1 82 50 discriminator 1 view .LVU125
 494 0038 A342     		cmp	r3, r4
 495 003a EBD3     		bcc	.L50
  83:Src/capture.c ****             }
 496              		.loc 1 83 17 is_stmt 1 view .LVU126
  83:Src/capture.c ****             }
 497              		.loc 1 83 24 is_stmt 0 view .LVU127
 498 003c 5C1C     		adds	r4, r3, #1
 499              	.LVL45:
  83:Src/capture.c ****             }
 500              		.loc 1 83 24 view .LVU128
 501 003e E9E7     		b	.L50
 502              	.L53:
  83:Src/capture.c ****             }
 503              		.loc 1 83 24 view .LVU129
 504              	.LBE3:
  86:Src/capture.c ****     }
 505              		.loc 1 86 9 is_stmt 1 view .LVU130
 506 0040 08A8     		add	r0, sp, #32
 507 0042 FFF7FEFF 		bl	f_closedir
 508              	.LVL46:
 509              	.L51:
  89:Src/capture.c **** }
 510              		.loc 1 89 5 view .LVU131
  89:Src/capture.c **** }
 511              		.loc 1 89 19 is_stmt 0 view .LVU132
 512 0046 6309     		lsrs	r3, r4, #5
 513 0048 054A     		ldr	r2, .L57+4
 514 004a A2FB0323 		umull	r2, r3, r2, r3
 515 004e DB09     		lsrs	r3, r3, #7
  90:Src/capture.c **** 
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 14


 516              		.loc 1 90 1 view .LVU133
 517 0050 0448     		ldr	r0, .L57+8
 518 0052 00FB1340 		mls	r0, r0, r3, r4
 519 0056 14B0     		add	sp, sp, #80
 520              	.LCFI7:
 521              		.cfi_def_cfa_offset 8
 522              		@ sp needed
 523 0058 10BD     		pop	{r4, pc}
 524              	.LVL47:
 525              	.L58:
  90:Src/capture.c **** 
 526              		.loc 1 90 1 view .LVU134
 527 005a 00BF     		.align	2
 528              	.L57:
 529 005c 00000000 		.word	.LC3
 530 0060 C55A7C0A 		.word	175921861
 531 0064 A0860100 		.word	100000
 532              		.cfi_endproc
 533              	.LFE149:
 535              		.section	.rodata.find_unused_filename.str1.4,"aMS",%progbits,1
 536              		.align	2
 537              	.LC4:
 538 0000 50253035 		.ascii	"P%05lu.JPG\000"
 538      6C752E4A 
 538      504700
 539 000b 00       		.align	2
 540              	.LC5:
 541 000c 50484F54 		.ascii	"PHOTO_%05lu.jpeg\000"
 541      4F5F2530 
 541      356C752E 
 541      6A706567 
 541      00
 542              		.section	.text.find_unused_filename,"ax",%progbits
 543              		.align	1
 544              		.syntax unified
 545              		.thumb
 546              		.thumb_func
 548              	find_unused_filename:
 549              	.LVL48:
 550              	.LFB151:
 109:Src/capture.c **** 
 110:Src/capture.c **** // Find unused filename, trying both long and short name formats
 111:Src/capture.c **** static FRESULT find_unused_filename(char *filename, size_t filename_size, uint32_t *photo_id_ptr)
 112:Src/capture.c **** {
 551              		.loc 1 112 1 is_stmt 1 view -0
 552              		.cfi_startproc
 553              		@ args = 0, pretend = 0, frame = 24
 554              		@ frame_needed = 0, uses_anonymous_args = 0
 555              		.loc 1 112 1 is_stmt 0 view .LVU136
 556 0000 2DE9F043 		push	{r4, r5, r6, r7, r8, r9, lr}
 557              	.LCFI8:
 558              		.cfi_def_cfa_offset 28
 559              		.cfi_offset 4, -28
 560              		.cfi_offset 5, -24
 561              		.cfi_offset 6, -20
 562              		.cfi_offset 7, -16
 563              		.cfi_offset 8, -12
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 15


 564              		.cfi_offset 9, -8
 565              		.cfi_offset 14, -4
 566 0004 87B0     		sub	sp, sp, #28
 567              	.LCFI9:
 568              		.cfi_def_cfa_offset 56
 569 0006 0746     		mov	r7, r0
 570 0008 8946     		mov	r9, r1
 571 000a 9046     		mov	r8, r2
 113:Src/capture.c ****     FILINFO finfo;
 572              		.loc 1 113 5 is_stmt 1 view .LVU137
 114:Src/capture.c ****     FRESULT res;
 573              		.loc 1 114 5 view .LVU138
 115:Src/capture.c ****     int use_short_name = 0;
 574              		.loc 1 115 5 view .LVU139
 575              	.LVL49:
 116:Src/capture.c ****     uint32_t attempts = 0;
 576              		.loc 1 116 5 view .LVU140
 117:Src/capture.c ****     uint32_t id = *photo_id_ptr;
 577              		.loc 1 117 5 view .LVU141
 578              		.loc 1 117 14 is_stmt 0 view .LVU142
 579 000c 1468     		ldr	r4, [r2]
 580              	.LVL50:
 118:Src/capture.c ****     
 119:Src/capture.c ****     while (attempts < MAX_FILENAME_ATTEMPTS) {
 581              		.loc 1 119 5 is_stmt 1 view .LVU143
 116:Src/capture.c ****     uint32_t id = *photo_id_ptr;
 582              		.loc 1 116 14 is_stmt 0 view .LVU144
 583 000e 0025     		movs	r5, #0
 115:Src/capture.c ****     uint32_t attempts = 0;
 584              		.loc 1 115 9 view .LVU145
 585 0010 2E46     		mov	r6, r5
 586              		.loc 1 119 11 view .LVU146
 587 0012 27E0     		b	.L60
 588              	.LVL51:
 589              	.L61:
 120:Src/capture.c ****         // Generate filename
 121:Src/capture.c ****         if (use_short_name) {
 122:Src/capture.c ****             snprintf(filename, filename_size, "P%05lu.JPG", id % MAX_PHOTO_ID);
 123:Src/capture.c ****         } else {
 124:Src/capture.c ****             snprintf(filename, filename_size, "PHOTO_%05lu.jpeg", id % MAX_PHOTO_ID);
 590              		.loc 1 124 13 is_stmt 1 view .LVU147
 591 0014 6309     		lsrs	r3, r4, #5
 592 0016 264A     		ldr	r2, .L71
 593 0018 A2FB0323 		umull	r2, r3, r2, r3
 594 001c DB09     		lsrs	r3, r3, #7
 595 001e 254A     		ldr	r2, .L71+4
 596 0020 02FB1343 		mls	r3, r2, r3, r4
 597 0024 244A     		ldr	r2, .L71+8
 598 0026 4946     		mov	r1, r9
 599 0028 3846     		mov	r0, r7
 600 002a FFF7FEFF 		bl	snprintf
 601              	.LVL52:
 602              	.L62:
 125:Src/capture.c ****         }
 126:Src/capture.c ****         
 127:Src/capture.c ****         // Check if file exists
 128:Src/capture.c ****         res = f_stat(filename, &finfo);
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 16


 603              		.loc 1 128 9 view .LVU148
 604              		.loc 1 128 15 is_stmt 0 view .LVU149
 605 002e 6946     		mov	r1, sp
 606 0030 3846     		mov	r0, r7
 607 0032 FFF7FEFF 		bl	f_stat
 608              	.LVL53:
 129:Src/capture.c ****         
 130:Src/capture.c ****         // If long filename not supported, switch to short names
 131:Src/capture.c ****         if (res == FR_INVALID_NAME && !use_short_name) {
 609              		.loc 1 131 9 is_stmt 1 view .LVU150
 610              		.loc 1 131 17 is_stmt 0 view .LVU151
 611 0036 0628     		cmp	r0, #6
 612 0038 14BF     		ite	ne
 613 003a 0023     		movne	r3, #0
 614 003c 0123     		moveq	r3, #1
 615              		.loc 1 131 39 view .LVU152
 616 003e 86F00102 		eor	r2, r6, #1
 617              		.loc 1 131 12 view .LVU153
 618 0042 1342     		tst	r3, r2
 619 0044 2ED1     		bne	.L67
 132:Src/capture.c ****             use_short_name = 1;
 133:Src/capture.c ****             continue; // Don't increment attempts, just retry with short name
 134:Src/capture.c ****         }
 135:Src/capture.c ****         
 136:Src/capture.c ****         // File doesn't exist - we can use this name
 137:Src/capture.c ****         if (res == FR_NO_FILE || res == FR_INVALID_NAME) {
 620              		.loc 1 137 9 is_stmt 1 view .LVU154
 621              		.loc 1 137 31 is_stmt 0 view .LVU155
 622 0046 0428     		cmp	r0, #4
 623 0048 08BF     		it	eq
 624 004a 43F00103 		orreq	r3, r3, #1
 625              		.loc 1 137 12 view .LVU156
 626 004e E3B9     		cbnz	r3, .L69
 138:Src/capture.c ****             *photo_id_ptr = (id + 1) % MAX_PHOTO_ID;
 139:Src/capture.c ****             return FR_OK;
 140:Src/capture.c ****         }
 141:Src/capture.c ****         
 142:Src/capture.c ****         // File exists or other error - try next ID
 143:Src/capture.c ****         id = (id + 1) % MAX_PHOTO_ID;
 627              		.loc 1 143 9 is_stmt 1 view .LVU157
 628              		.loc 1 143 18 is_stmt 0 view .LVU158
 629 0050 631C     		adds	r3, r4, #1
 630              		.loc 1 143 12 view .LVU159
 631 0052 5C09     		lsrs	r4, r3, #5
 632              	.LVL54:
 633              		.loc 1 143 12 view .LVU160
 634 0054 164A     		ldr	r2, .L71
 635 0056 A2FB0424 		umull	r2, r4, r2, r4
 636 005a E409     		lsrs	r4, r4, #7
 637 005c 154A     		ldr	r2, .L71+4
 638 005e 02FB1434 		mls	r4, r2, r4, r3
 639              	.LVL55:
 144:Src/capture.c ****         attempts++;
 640              		.loc 1 144 9 is_stmt 1 view .LVU161
 641              		.loc 1 144 17 is_stmt 0 view .LVU162
 642 0062 0135     		adds	r5, r5, #1
 643              	.LVL56:
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 17


 644              	.L60:
 119:Src/capture.c ****         // Generate filename
 645              		.loc 1 119 21 is_stmt 1 view .LVU163
 646 0064 B5F57A7F 		cmp	r5, #1000
 647 0068 1ED2     		bcs	.L70
 121:Src/capture.c ****             snprintf(filename, filename_size, "P%05lu.JPG", id % MAX_PHOTO_ID);
 648              		.loc 1 121 9 view .LVU164
 121:Src/capture.c ****             snprintf(filename, filename_size, "P%05lu.JPG", id % MAX_PHOTO_ID);
 649              		.loc 1 121 12 is_stmt 0 view .LVU165
 650 006a 002E     		cmp	r6, #0
 651 006c D2D0     		beq	.L61
 122:Src/capture.c ****         } else {
 652              		.loc 1 122 13 is_stmt 1 view .LVU166
 653 006e 6309     		lsrs	r3, r4, #5
 654 0070 0F4A     		ldr	r2, .L71
 655 0072 A2FB0323 		umull	r2, r3, r2, r3
 656 0076 DB09     		lsrs	r3, r3, #7
 657 0078 0E4A     		ldr	r2, .L71+4
 658 007a 02FB1343 		mls	r3, r2, r3, r4
 659 007e 0F4A     		ldr	r2, .L71+12
 660 0080 4946     		mov	r1, r9
 661 0082 3846     		mov	r0, r7
 662 0084 FFF7FEFF 		bl	snprintf
 663              	.LVL57:
 664 0088 D1E7     		b	.L62
 665              	.LVL58:
 666              	.L69:
 138:Src/capture.c ****             return FR_OK;
 667              		.loc 1 138 13 view .LVU167
 138:Src/capture.c ****             return FR_OK;
 668              		.loc 1 138 33 is_stmt 0 view .LVU168
 669 008a 0134     		adds	r4, r4, #1
 670              	.LVL59:
 138:Src/capture.c ****             return FR_OK;
 671              		.loc 1 138 38 view .LVU169
 672 008c 6309     		lsrs	r3, r4, #5
 673 008e 084A     		ldr	r2, .L71
 674 0090 A2FB0323 		umull	r2, r3, r2, r3
 675 0094 DB09     		lsrs	r3, r3, #7
 676 0096 074A     		ldr	r2, .L71+4
 677 0098 02FB1343 		mls	r3, r2, r3, r4
 138:Src/capture.c ****             return FR_OK;
 678              		.loc 1 138 27 view .LVU170
 679 009c C8F80030 		str	r3, [r8]
 139:Src/capture.c ****         }
 680              		.loc 1 139 13 is_stmt 1 view .LVU171
 139:Src/capture.c ****         }
 681              		.loc 1 139 20 is_stmt 0 view .LVU172
 682 00a0 0020     		movs	r0, #0
 683              	.LVL60:
 139:Src/capture.c ****         }
 684              		.loc 1 139 20 view .LVU173
 685 00a2 02E0     		b	.L65
 686              	.LVL61:
 687              	.L67:
 132:Src/capture.c ****             continue; // Don't increment attempts, just retry with short name
 688              		.loc 1 132 28 view .LVU174
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 18


 689 00a4 0126     		movs	r6, #1
 690              	.LVL62:
 132:Src/capture.c ****             continue; // Don't increment attempts, just retry with short name
 691              		.loc 1 132 28 view .LVU175
 692 00a6 DDE7     		b	.L60
 693              	.LVL63:
 694              	.L70:
 145:Src/capture.c ****     }
 146:Src/capture.c ****     
 147:Src/capture.c ****     return FR_DENIED; // No free filename found
 695              		.loc 1 147 12 view .LVU176
 696 00a8 0720     		movs	r0, #7
 697              	.LVL64:
 698              	.L65:
 148:Src/capture.c **** }
 699              		.loc 1 148 1 view .LVU177
 700 00aa 07B0     		add	sp, sp, #28
 701              	.LCFI10:
 702              		.cfi_def_cfa_offset 28
 703              		@ sp needed
 704 00ac BDE8F083 		pop	{r4, r5, r6, r7, r8, r9, pc}
 705              	.LVL65:
 706              	.L72:
 707              		.loc 1 148 1 view .LVU178
 708              		.align	2
 709              	.L71:
 710 00b0 C55A7C0A 		.word	175921861
 711 00b4 A0860100 		.word	100000
 712 00b8 0C000000 		.word	.LC5
 713 00bc 00000000 		.word	.LC4
 714              		.cfi_endproc
 715              	.LFE151:
 717              		.section	.rodata.take_A_Picture.str1.4,"aMS",%progbits,1
 718              		.align	2
 719              	.LC6:
 720 0000 4E6F2066 		.ascii	"No free filename\000"
 720      72656520 
 720      66696C65 
 720      6E616D65 
 720      00
 721 0011 000000   		.align	2
 722              	.LC7:
 723 0014 43726561 		.ascii	"Creating file...\000"
 723      74696E67 
 723      2066696C 
 723      652E2E2E 
 723      00
 724 0025 000000   		.align	2
 725              	.LC8:
 726 0028 46696C65 		.ascii	"File open err:%d\000"
 726      206F7065 
 726      6E206572 
 726      723A2564 
 726      00
 727 0039 000000   		.align	2
 728              	.LC9:
 729 003c 43617074 		.ascii	"Capturing...\000"
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 19


 729      7572696E 
 729      672E2E2E 
 729      00
 730 0049 000000   		.align	2
 731              	.LC10:
 732 004c 444D4120 		.ascii	"DMA start failed\000"
 732      73746172 
 732      74206661 
 732      696C6564 
 732      00
 733 005d 000000   		.align	2
 734              	.LC11:
 735 0060 5653594E 		.ascii	"VSYNC timeout\000"
 735      43207469 
 735      6D656F75 
 735      7400
 736 006e 0000     		.align	2
 737              	.LC12:
 738 0070 4672616D 		.ascii	"Frame timeout\000"
 738      65207469 
 738      6D656F75 
 738      7400
 739 007e 0000     		.align	2
 740              	.LC13:
 741 0080 44434D49 		.ascii	"DCMI stop failed\000"
 741      2073746F 
 741      70206661 
 741      696C6564 
 741      00
 742 0091 000000   		.align	2
 743              	.LC14:
 744 0094 496E7661 		.ascii	"Invalid JPEG\000"
 744      6C696420 
 744      4A504547 
 744      00
 745 00a1 000000   		.align	2
 746              	.LC15:
 747 00a4 57726974 		.ascii	"Write err:%d\000"
 747      65206572 
 747      723A2564 
 747      00
 748 00b1 000000   		.align	2
 749              	.LC16:
 750 00b4 53617665 		.ascii	"Saved %lu bytes\000"
 750      6420256C 
 750      75206279 
 750      74657300 
 751              		.section	.text.take_A_Picture,"ax",%progbits
 752              		.align	1
 753              		.global	take_A_Picture
 754              		.syntax unified
 755              		.thumb
 756              		.thumb_func
 758              	take_A_Picture:
 759              	.LVL66:
 760              	.LFB152:
 149:Src/capture.c **** 
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 20


 150:Src/capture.c **** // Capture JPEG image and save to SD card
 151:Src/capture.c **** uint8_t take_A_Picture(DCMI_HandleTypeDef *hdcmi)
 152:Src/capture.c **** {
 761              		.loc 1 152 1 is_stmt 1 view -0
 762              		.cfi_startproc
 763              		@ args = 0, pretend = 0, frame = 664
 764              		@ frame_needed = 0, uses_anonymous_args = 0
 765              		.loc 1 152 1 is_stmt 0 view .LVU180
 766 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 767              	.LCFI11:
 768              		.cfi_def_cfa_offset 20
 769              		.cfi_offset 4, -20
 770              		.cfi_offset 5, -16
 771              		.cfi_offset 6, -12
 772              		.cfi_offset 7, -8
 773              		.cfi_offset 14, -4
 774 0002 ADF5297D 		sub	sp, sp, #676
 775              	.LCFI12:
 776              		.cfi_def_cfa_offset 696
 777 0006 0546     		mov	r5, r0
 153:Src/capture.c ****     FRESULT res;
 778              		.loc 1 153 5 is_stmt 1 view .LVU181
 154:Src/capture.c ****     char filename[32];
 779              		.loc 1 154 5 view .LVU182
 155:Src/capture.c ****     char msg[64];
 780              		.loc 1 155 5 view .LVU183
 156:Src/capture.c ****     
 157:Src/capture.c ****     // Ensure SD card is mounted
 158:Src/capture.c ****     if (!ensure_sd_mounted()) {
 781              		.loc 1 158 5 view .LVU184
 782              		.loc 1 158 10 is_stmt 0 view .LVU185
 783 0008 FFF7FEFF 		bl	ensure_sd_mounted
 784              	.LVL67:
 785              		.loc 1 158 8 discriminator 1 view .LVU186
 786 000c 20B9     		cbnz	r0, .L100
 159:Src/capture.c ****         return 0;
 787              		.loc 1 159 16 view .LVU187
 788 000e 0026     		movs	r6, #0
 789              	.LVL68:
 790              	.L74:
 160:Src/capture.c ****     }
 161:Src/capture.c ****     
 162:Src/capture.c ****     // Find next available photo ID and filename
 163:Src/capture.c ****     photo_id = find_next_photo_id();
 164:Src/capture.c ****     res = find_unused_filename(filename, sizeof(filename), &photo_id);
 165:Src/capture.c ****     
 166:Src/capture.c ****     if (res != FR_OK) {
 167:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"No free filename");
 168:Src/capture.c ****         return 0;
 169:Src/capture.c ****     }
 170:Src/capture.c ****     
 171:Src/capture.c ****     // Create file
 172:Src/capture.c ****     LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"Creating file...");
 173:Src/capture.c ****     
 174:Src/capture.c ****     FIL capture_file;
 175:Src/capture.c ****     res = f_open(&capture_file, filename, FA_CREATE_NEW | FA_WRITE);
 176:Src/capture.c ****     if (res != FR_OK) {
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 21


 177:Src/capture.c ****         snprintf(msg, sizeof(msg), "File open err:%d", res);
 178:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)msg);
 179:Src/capture.c ****         return 0;
 180:Src/capture.c ****     }
 181:Src/capture.c ****     
 182:Src/capture.c ****     // Prepare for capture
 183:Src/capture.c ****     memset(jpeg_buffer, 0, JPEG_BUFFER_SIZE);
 184:Src/capture.c ****     DCMI_FrameIsReady = 0;
 185:Src/capture.c ****     DCMI_VsyncFlag = 0;
 186:Src/capture.c ****     
 187:Src/capture.c ****     // Configure camera for JPEG mode
 188:Src/capture.c ****     Camera_Picture_Device(&hi2c1);
 189:Src/capture.c ****     HAL_Delay(50);
 190:Src/capture.c ****     
 191:Src/capture.c ****     // Clear DCMI flags and enable interrupts
 192:Src/capture.c ****     __HAL_DCMI_CLEAR_FLAG(hdcmi, DCMI_FLAG_FRAMERI | DCMI_FLAG_VSYNCRI | 
 193:Src/capture.c ****                           DCMI_FLAG_ERRRI | DCMI_FLAG_OVRRI | DCMI_FLAG_LINERI);
 194:Src/capture.c ****     __HAL_DCMI_ENABLE_IT(hdcmi, DCMI_IT_FRAME | DCMI_IT_VSYNC);
 195:Src/capture.c ****     
 196:Src/capture.c ****     // CRITICAL: Invalidate cache before DMA writes to buffer
 197:Src/capture.c ****     // This discards any stale cache lines so DMA has clean memory to write to
 198:Src/capture.c **** #if defined(SCB_InvalidateDCache_by_Addr)
 199:Src/capture.c ****     SCB_InvalidateDCache_by_Addr((uint32_t*)jpeg_buffer, JPEG_BUFFER_SIZE);
 200:Src/capture.c **** #endif
 201:Src/capture.c ****     
 202:Src/capture.c ****     // Start DCMI DMA capture
 203:Src/capture.c ****     LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"Capturing...");
 204:Src/capture.c ****     
 205:Src/capture.c ****     if (HAL_DCMI_Start_DMA(hdcmi, DCMI_MODE_SNAPSHOT, (uint32_t)jpeg_buffer, 
 206:Src/capture.c ****                            JPEG_BUFFER_WORDS) != HAL_OK) {
 207:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"DMA start failed");
 208:Src/capture.c ****         f_close(&capture_file);
 209:Src/capture.c ****         return 0;
 210:Src/capture.c ****     }
 211:Src/capture.c ****     
 212:Src/capture.c ****     // Wait for VSYNC signal
 213:Src/capture.c ****     uint32_t wait_ms = 0;
 214:Src/capture.c ****     while (!DCMI_VsyncFlag && wait_ms < VSYNC_TIMEOUT_MS) {
 215:Src/capture.c ****         HAL_Delay(DELAY_STEP_MS);
 216:Src/capture.c ****         wait_ms += DELAY_STEP_MS;
 217:Src/capture.c ****     }
 218:Src/capture.c ****     
 219:Src/capture.c ****     if (!DCMI_VsyncFlag) {
 220:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"VSYNC timeout");
 221:Src/capture.c ****         HAL_DCMI_Stop(hdcmi);
 222:Src/capture.c ****         f_close(&capture_file);
 223:Src/capture.c ****         return 0;
 224:Src/capture.c ****     }
 225:Src/capture.c ****     
 226:Src/capture.c ****     // Wait for frame capture to complete
 227:Src/capture.c ****     wait_ms = 0;
 228:Src/capture.c ****     while (!DCMI_FrameIsReady && wait_ms < FRAME_TIMEOUT_MS) {
 229:Src/capture.c ****         HAL_Delay(DELAY_STEP_MS);
 230:Src/capture.c ****         wait_ms += DELAY_STEP_MS;
 231:Src/capture.c ****     }
 232:Src/capture.c ****     
 233:Src/capture.c ****     if (!DCMI_FrameIsReady) {
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 22


 234:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"Frame timeout");
 235:Src/capture.c ****         HAL_DCMI_Stop(hdcmi);
 236:Src/capture.c ****         f_close(&capture_file);
 237:Src/capture.c ****         return 0;
 238:Src/capture.c ****     }
 239:Src/capture.c ****     
 240:Src/capture.c ****     // Stop DCMI
 241:Src/capture.c ****     if (HAL_DCMI_Stop(hdcmi) != HAL_OK) {
 242:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"DCMI stop failed");
 243:Src/capture.c ****         f_close(&capture_file);
 244:Src/capture.c ****         return 0;
 245:Src/capture.c ****     }
 246:Src/capture.c ****     
 247:Src/capture.c ****     // Invalidate cache to ensure we read DMA data
 248:Src/capture.c **** #if defined(SCB_InvalidateDCache_by_Addr)
 249:Src/capture.c ****     SCB_InvalidateDCache_by_Addr((uint32_t*)jpeg_buffer, JPEG_BUFFER_SIZE);
 250:Src/capture.c **** #endif
 251:Src/capture.c ****     
 252:Src/capture.c ****     // Find JPEG Start of Image (SOI: 0xFFD8) and End of Image (EOI: 0xFFD9)
 253:Src/capture.c ****     uint32_t soi_pos = JPEG_BUFFER_SIZE;
 254:Src/capture.c ****     uint32_t eoi_pos = JPEG_BUFFER_SIZE;
 255:Src/capture.c ****     
 256:Src/capture.c ****     for (uint32_t i = 0; i + 1 < JPEG_BUFFER_SIZE; i++) {
 257:Src/capture.c ****         if (soi_pos == JPEG_BUFFER_SIZE && 
 258:Src/capture.c ****             jpeg_buffer[i] == 0xFF && jpeg_buffer[i+1] == 0xD8) {
 259:Src/capture.c ****             soi_pos = i;
 260:Src/capture.c ****         }
 261:Src/capture.c ****         if (soi_pos != JPEG_BUFFER_SIZE && 
 262:Src/capture.c ****             jpeg_buffer[i] == 0xFF && jpeg_buffer[i+1] == 0xD9) {
 263:Src/capture.c ****             eoi_pos = i + 2;
 264:Src/capture.c ****             break;
 265:Src/capture.c ****         }
 266:Src/capture.c ****     }
 267:Src/capture.c ****     
 268:Src/capture.c ****     // Validate JPEG markers found
 269:Src/capture.c ****     if (soi_pos == JPEG_BUFFER_SIZE || eoi_pos == JPEG_BUFFER_SIZE || eoi_pos <= soi_pos) {
 270:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"Invalid JPEG");
 271:Src/capture.c ****         f_close(&capture_file);
 272:Src/capture.c ****         return 0;
 273:Src/capture.c ****     }
 274:Src/capture.c ****     
 275:Src/capture.c ****     // Write JPEG data to file
 276:Src/capture.c ****     uint32_t jpeg_size = eoi_pos - soi_pos;
 277:Src/capture.c ****     UINT bytes_written = 0;
 278:Src/capture.c ****     
 279:Src/capture.c ****     res = f_write(&capture_file, &jpeg_buffer[soi_pos], jpeg_size, &bytes_written);
 280:Src/capture.c ****     if (res != FR_OK || bytes_written != jpeg_size) {
 281:Src/capture.c ****         snprintf(msg, sizeof(msg), "Write err:%d", res);
 282:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)msg);
 283:Src/capture.c ****         f_close(&capture_file);
 284:Src/capture.c ****         return 0;
 285:Src/capture.c ****     }
 286:Src/capture.c ****     
 287:Src/capture.c ****     // Sync and close file
 288:Src/capture.c ****     f_sync(&capture_file);
 289:Src/capture.c ****     f_close(&capture_file);
 290:Src/capture.c ****     
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 23


 291:Src/capture.c ****     // Display success message
 292:Src/capture.c ****     snprintf(msg, sizeof(msg), "Saved %lu bytes", (unsigned long)bytes_written);
 293:Src/capture.c ****     LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)msg);
 294:Src/capture.c ****     
 295:Src/capture.c ****     return 1;
 296:Src/capture.c **** }...
 791              		.loc 1 296 1 view .LVU188
 792 0010 3046     		mov	r0, r6
 793 0012 0DF5297D 		add	sp, sp, #676
 794              	.LCFI13:
 795              		.cfi_remember_state
 796              		.cfi_def_cfa_offset 20
 797              		@ sp needed
 798 0016 F0BD     		pop	{r4, r5, r6, r7, pc}
 799              	.LVL69:
 800              	.L100:
 801              	.LCFI14:
 802              		.cfi_restore_state
 163:Src/capture.c ****     photo_id = find_next_photo_id();
 803              		.loc 1 163 5 is_stmt 1 view .LVU189
 163:Src/capture.c ****     photo_id = find_next_photo_id();
 804              		.loc 1 163 16 is_stmt 0 view .LVU190
 805 0018 FFF7FEFF 		bl	find_next_photo_id
 806              	.LVL70:
 163:Src/capture.c ****     photo_id = find_next_photo_id();
 807              		.loc 1 163 14 discriminator 1 view .LVU191
 808 001c A44A     		ldr	r2, .L110
 809 001e 1060     		str	r0, [r2]
 164:Src/capture.c ****     res = find_unused_filename(filename, sizeof(filename), &photo_id);
 810              		.loc 1 164 5 is_stmt 1 view .LVU192
 164:Src/capture.c ****     res = find_unused_filename(filename, sizeof(filename), &photo_id);
 811              		.loc 1 164 11 is_stmt 0 view .LVU193
 812 0020 2021     		movs	r1, #32
 813 0022 A0A8     		add	r0, sp, #640
 814 0024 FFF7FEFF 		bl	find_unused_filename
 815              	.LVL71:
 166:Src/capture.c ****     if (res != FR_OK) {
 816              		.loc 1 166 5 is_stmt 1 view .LVU194
 166:Src/capture.c ****     if (res != FR_OK) {
 817              		.loc 1 166 8 is_stmt 0 view .LVU195
 818 0028 0646     		mov	r6, r0
 819 002a 0028     		cmp	r0, #0
 820 002c 42D1     		bne	.L101
 172:Src/capture.c ****     LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"Creating file...");
 821              		.loc 1 172 5 is_stmt 1 view .LVU196
 822 002e A14B     		ldr	r3, .L110+4
 823 0030 0193     		str	r3, [sp, #4]
 824 0032 0C23     		movs	r3, #12
 825 0034 0093     		str	r3, [sp]
 826 0036 0523     		movs	r3, #5
 827 0038 9F4A     		ldr	r2, .L110+8
 828 003a 1288     		ldrh	r2, [r2]
 829 003c 3221     		movs	r1, #50
 830 003e 0020     		movs	r0, #0
 831              	.LVL72:
 172:Src/capture.c ****     LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"Creating file...");
 832              		.loc 1 172 5 is_stmt 0 view .LVU197
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 24


 833 0040 FFF7FEFF 		bl	LCD_ShowString
 834              	.LVL73:
 174:Src/capture.c ****     FIL capture_file;
 835              		.loc 1 174 5 is_stmt 1 view .LVU198
 175:Src/capture.c ****     res = f_open(&capture_file, filename, FA_CREATE_NEW | FA_WRITE);
 836              		.loc 1 175 5 view .LVU199
 175:Src/capture.c ****     res = f_open(&capture_file, filename, FA_CREATE_NEW | FA_WRITE);
 837              		.loc 1 175 11 is_stmt 0 view .LVU200
 838 0044 0622     		movs	r2, #6
 839 0046 A0A9     		add	r1, sp, #640
 840 0048 04A8     		add	r0, sp, #16
 841 004a FFF7FEFF 		bl	f_open
 842              	.LVL74:
 176:Src/capture.c ****     if (res != FR_OK) {
 843              		.loc 1 176 5 is_stmt 1 view .LVU201
 176:Src/capture.c ****     if (res != FR_OK) {
 844              		.loc 1 176 8 is_stmt 0 view .LVU202
 845 004e 0746     		mov	r7, r0
 846 0050 0028     		cmp	r0, #0
 847 0052 3CD1     		bne	.L102
 183:Src/capture.c ****     memset(jpeg_buffer, 0, JPEG_BUFFER_SIZE);
 848              		.loc 1 183 5 is_stmt 1 view .LVU203
 849 0054 994E     		ldr	r6, .L110+12
 850 0056 4FF4E022 		mov	r2, #458752
 851 005a 0021     		movs	r1, #0
 852 005c 3046     		mov	r0, r6
 853              	.LVL75:
 183:Src/capture.c ****     memset(jpeg_buffer, 0, JPEG_BUFFER_SIZE);
 854              		.loc 1 183 5 is_stmt 0 view .LVU204
 855 005e FFF7FEFF 		bl	memset
 856              	.LVL76:
 184:Src/capture.c ****     DCMI_FrameIsReady = 0;
 857              		.loc 1 184 5 is_stmt 1 view .LVU205
 184:Src/capture.c ****     DCMI_FrameIsReady = 0;
 858              		.loc 1 184 23 is_stmt 0 view .LVU206
 859 0062 0024     		movs	r4, #0
 860 0064 964B     		ldr	r3, .L110+16
 861 0066 1C60     		str	r4, [r3]
 185:Src/capture.c ****     DCMI_VsyncFlag = 0;
 862              		.loc 1 185 5 is_stmt 1 view .LVU207
 185:Src/capture.c ****     DCMI_VsyncFlag = 0;
 863              		.loc 1 185 20 is_stmt 0 view .LVU208
 864 0068 964B     		ldr	r3, .L110+20
 865 006a 1C60     		str	r4, [r3]
 188:Src/capture.c ****     Camera_Picture_Device(&hi2c1);
 866              		.loc 1 188 5 is_stmt 1 view .LVU209
 867 006c 9648     		ldr	r0, .L110+24
 868 006e FFF7FEFF 		bl	Camera_Picture_Device
 869              	.LVL77:
 189:Src/capture.c ****     HAL_Delay(50);
 870              		.loc 1 189 5 view .LVU210
 871 0072 3220     		movs	r0, #50
 872 0074 FFF7FEFF 		bl	HAL_Delay
 873              	.LVL78:
 192:Src/capture.c ****     __HAL_DCMI_CLEAR_FLAG(hdcmi, DCMI_FLAG_FRAMERI | DCMI_FLAG_VSYNCRI | 
 874              		.loc 1 192 5 view .LVU211
 875 0078 2B68     		ldr	r3, [r5]
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 25


 876 007a 1F22     		movs	r2, #31
 877 007c 5A61     		str	r2, [r3, #20]
 194:Src/capture.c ****     __HAL_DCMI_ENABLE_IT(hdcmi, DCMI_IT_FRAME | DCMI_IT_VSYNC);
 878              		.loc 1 194 5 view .LVU212
 879 007e 2A68     		ldr	r2, [r5]
 880 0080 D368     		ldr	r3, [r2, #12]
 881 0082 43F00903 		orr	r3, r3, #9
 882 0086 D360     		str	r3, [r2, #12]
 203:Src/capture.c ****     LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"Capturing...");
 883              		.loc 1 203 5 view .LVU213
 884 0088 904B     		ldr	r3, .L110+28
 885 008a 0193     		str	r3, [sp, #4]
 886 008c 0C23     		movs	r3, #12
 887 008e 0093     		str	r3, [sp]
 888 0090 0523     		movs	r3, #5
 889 0092 894A     		ldr	r2, .L110+8
 890 0094 1288     		ldrh	r2, [r2]
 891 0096 3221     		movs	r1, #50
 892 0098 2046     		mov	r0, r4
 893 009a FFF7FEFF 		bl	LCD_ShowString
 894              	.LVL79:
 205:Src/capture.c ****     if (HAL_DCMI_Start_DMA(hdcmi, DCMI_MODE_SNAPSHOT, (uint32_t)jpeg_buffer, 
 895              		.loc 1 205 5 view .LVU214
 205:Src/capture.c ****     if (HAL_DCMI_Start_DMA(hdcmi, DCMI_MODE_SNAPSHOT, (uint32_t)jpeg_buffer, 
 896              		.loc 1 205 9 is_stmt 0 view .LVU215
 897 009e 4FF4E033 		mov	r3, #114688
 898 00a2 3246     		mov	r2, r6
 899 00a4 0221     		movs	r1, #2
 900 00a6 2846     		mov	r0, r5
 901 00a8 FFF7FEFF 		bl	HAL_DCMI_Start_DMA
 902              	.LVL80:
 205:Src/capture.c ****     if (HAL_DCMI_Start_DMA(hdcmi, DCMI_MODE_SNAPSHOT, (uint32_t)jpeg_buffer, 
 903              		.loc 1 205 8 discriminator 1 view .LVU216
 904 00ac 0646     		mov	r6, r0
 905 00ae 00BB     		cbnz	r0, .L103
 213:Src/capture.c ****     uint32_t wait_ms = 0;
 906              		.loc 1 213 14 view .LVU217
 907 00b0 0024     		movs	r4, #0
 908 00b2 32E0     		b	.L77
 909              	.LVL81:
 910              	.L101:
 167:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"No free filename");
 911              		.loc 1 167 9 is_stmt 1 view .LVU218
 912 00b4 864B     		ldr	r3, .L110+32
 913 00b6 0193     		str	r3, [sp, #4]
 914 00b8 0C23     		movs	r3, #12
 915 00ba 0093     		str	r3, [sp]
 916 00bc 0523     		movs	r3, #5
 917 00be 7E4A     		ldr	r2, .L110+8
 918 00c0 1288     		ldrh	r2, [r2]
 919 00c2 3221     		movs	r1, #50
 920 00c4 0020     		movs	r0, #0
 921              	.LVL82:
 167:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"No free filename");
 922              		.loc 1 167 9 is_stmt 0 view .LVU219
 923 00c6 FFF7FEFF 		bl	LCD_ShowString
 924              	.LVL83:
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 26


 168:Src/capture.c ****         return 0;
 925              		.loc 1 168 9 is_stmt 1 view .LVU220
 168:Src/capture.c ****         return 0;
 926              		.loc 1 168 16 is_stmt 0 view .LVU221
 927 00ca 0026     		movs	r6, #0
 928              	.LVL84:
 168:Src/capture.c ****         return 0;
 929              		.loc 1 168 16 view .LVU222
 930 00cc A0E7     		b	.L74
 931              	.LVL85:
 932              	.L102:
 177:Src/capture.c ****         snprintf(msg, sizeof(msg), "File open err:%d", res);
 933              		.loc 1 177 9 is_stmt 1 view .LVU223
 934 00ce 90AC     		add	r4, sp, #576
 935 00d0 0346     		mov	r3, r0
 936 00d2 804A     		ldr	r2, .L110+36
 937 00d4 4021     		movs	r1, #64
 938 00d6 2046     		mov	r0, r4
 939              	.LVL86:
 177:Src/capture.c ****         snprintf(msg, sizeof(msg), "File open err:%d", res);
 940              		.loc 1 177 9 is_stmt 0 view .LVU224
 941 00d8 FFF7FEFF 		bl	snprintf
 942              	.LVL87:
 178:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)msg);
 943              		.loc 1 178 9 is_stmt 1 view .LVU225
 944 00dc 0194     		str	r4, [sp, #4]
 945 00de 0C23     		movs	r3, #12
 946 00e0 0093     		str	r3, [sp]
 947 00e2 0523     		movs	r3, #5
 948 00e4 744A     		ldr	r2, .L110+8
 949 00e6 1288     		ldrh	r2, [r2]
 950 00e8 3221     		movs	r1, #50
 951 00ea 0020     		movs	r0, #0
 952 00ec FFF7FEFF 		bl	LCD_ShowString
 953              	.LVL88:
 179:Src/capture.c ****         return 0;
 954              		.loc 1 179 9 view .LVU226
 179:Src/capture.c ****         return 0;
 955              		.loc 1 179 16 is_stmt 0 view .LVU227
 956 00f0 8EE7     		b	.L74
 957              	.L103:
 207:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"DMA start failed");
 958              		.loc 1 207 9 is_stmt 1 view .LVU228
 959 00f2 794B     		ldr	r3, .L110+40
 960 00f4 0193     		str	r3, [sp, #4]
 961 00f6 0C23     		movs	r3, #12
 962 00f8 0093     		str	r3, [sp]
 963 00fa 0523     		movs	r3, #5
 964 00fc 6E4A     		ldr	r2, .L110+8
 965 00fe 1288     		ldrh	r2, [r2]
 966 0100 3221     		movs	r1, #50
 967 0102 2046     		mov	r0, r4
 968 0104 FFF7FEFF 		bl	LCD_ShowString
 969              	.LVL89:
 208:Src/capture.c ****         f_close(&capture_file);
 970              		.loc 1 208 9 view .LVU229
 971 0108 04A8     		add	r0, sp, #16
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 27


 972 010a FFF7FEFF 		bl	f_close
 973              	.LVL90:
 209:Src/capture.c ****         return 0;
 974              		.loc 1 209 9 view .LVU230
 209:Src/capture.c ****         return 0;
 975              		.loc 1 209 16 is_stmt 0 view .LVU231
 976 010e 3E46     		mov	r6, r7
 977 0110 7EE7     		b	.L74
 978              	.LVL91:
 979              	.L79:
 215:Src/capture.c ****         HAL_Delay(DELAY_STEP_MS);
 980              		.loc 1 215 9 is_stmt 1 view .LVU232
 981 0112 0A20     		movs	r0, #10
 982 0114 FFF7FEFF 		bl	HAL_Delay
 983              	.LVL92:
 216:Src/capture.c ****         wait_ms += DELAY_STEP_MS;
 984              		.loc 1 216 9 view .LVU233
 216:Src/capture.c ****         wait_ms += DELAY_STEP_MS;
 985              		.loc 1 216 17 is_stmt 0 view .LVU234
 986 0118 0A34     		adds	r4, r4, #10
 987              	.LVL93:
 988              	.L77:
 214:Src/capture.c ****     while (!DCMI_VsyncFlag && wait_ms < VSYNC_TIMEOUT_MS) {
 989              		.loc 1 214 28 is_stmt 1 view .LVU235
 214:Src/capture.c ****     while (!DCMI_VsyncFlag && wait_ms < VSYNC_TIMEOUT_MS) {
 990              		.loc 1 214 12 is_stmt 0 view .LVU236
 991 011a 6A4B     		ldr	r3, .L110+20
 992 011c 1B68     		ldr	r3, [r3]
 214:Src/capture.c ****     while (!DCMI_VsyncFlag && wait_ms < VSYNC_TIMEOUT_MS) {
 993              		.loc 1 214 28 view .LVU237
 994 011e 13B9     		cbnz	r3, .L78
 214:Src/capture.c ****     while (!DCMI_VsyncFlag && wait_ms < VSYNC_TIMEOUT_MS) {
 995              		.loc 1 214 28 discriminator 1 view .LVU238
 996 0120 B4F57A7F 		cmp	r4, #1000
 997 0124 F5D3     		bcc	.L79
 998              	.L78:
 219:Src/capture.c ****     if (!DCMI_VsyncFlag) {
 999              		.loc 1 219 5 is_stmt 1 view .LVU239
 219:Src/capture.c ****     if (!DCMI_VsyncFlag) {
 1000              		.loc 1 219 9 is_stmt 0 view .LVU240
 1001 0126 674B     		ldr	r3, .L110+20
 1002 0128 1B68     		ldr	r3, [r3]
 219:Src/capture.c ****     if (!DCMI_VsyncFlag) {
 1003              		.loc 1 219 8 view .LVU241
 1004 012a 0BB1     		cbz	r3, .L104
 227:Src/capture.c ****     wait_ms = 0;
 1005              		.loc 1 227 13 view .LVU242
 1006 012c 0024     		movs	r4, #0
 1007              	.LVL94:
 227:Src/capture.c ****     wait_ms = 0;
 1008              		.loc 1 227 13 view .LVU243
 1009 012e 15E0     		b	.L80
 1010              	.LVL95:
 1011              	.L104:
 220:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"VSYNC timeout");
 1012              		.loc 1 220 9 is_stmt 1 view .LVU244
 1013 0130 6A4B     		ldr	r3, .L110+44
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 28


 1014 0132 0193     		str	r3, [sp, #4]
 1015 0134 0C23     		movs	r3, #12
 1016 0136 0093     		str	r3, [sp]
 1017 0138 0523     		movs	r3, #5
 1018 013a 5F4A     		ldr	r2, .L110+8
 1019 013c 1288     		ldrh	r2, [r2]
 1020 013e 3221     		movs	r1, #50
 1021 0140 0020     		movs	r0, #0
 1022 0142 FFF7FEFF 		bl	LCD_ShowString
 1023              	.LVL96:
 221:Src/capture.c ****         HAL_DCMI_Stop(hdcmi);
 1024              		.loc 1 221 9 view .LVU245
 1025 0146 2846     		mov	r0, r5
 1026 0148 FFF7FEFF 		bl	HAL_DCMI_Stop
 1027              	.LVL97:
 222:Src/capture.c ****         f_close(&capture_file);
 1028              		.loc 1 222 9 view .LVU246
 1029 014c 04A8     		add	r0, sp, #16
 1030 014e FFF7FEFF 		bl	f_close
 1031              	.LVL98:
 223:Src/capture.c ****         return 0;
 1032              		.loc 1 223 9 view .LVU247
 223:Src/capture.c ****         return 0;
 1033              		.loc 1 223 16 is_stmt 0 view .LVU248
 1034 0152 5DE7     		b	.L74
 1035              	.L82:
 229:Src/capture.c ****         HAL_Delay(DELAY_STEP_MS);
 1036              		.loc 1 229 9 is_stmt 1 view .LVU249
 1037 0154 0A20     		movs	r0, #10
 1038 0156 FFF7FEFF 		bl	HAL_Delay
 1039              	.LVL99:
 230:Src/capture.c ****         wait_ms += DELAY_STEP_MS;
 1040              		.loc 1 230 9 view .LVU250
 230:Src/capture.c ****         wait_ms += DELAY_STEP_MS;
 1041              		.loc 1 230 17 is_stmt 0 view .LVU251
 1042 015a 0A34     		adds	r4, r4, #10
 1043              	.LVL100:
 1044              	.L80:
 228:Src/capture.c ****     while (!DCMI_FrameIsReady && wait_ms < FRAME_TIMEOUT_MS) {
 1045              		.loc 1 228 31 is_stmt 1 view .LVU252
 228:Src/capture.c ****     while (!DCMI_FrameIsReady && wait_ms < FRAME_TIMEOUT_MS) {
 1046              		.loc 1 228 12 is_stmt 0 view .LVU253
 1047 015c 584B     		ldr	r3, .L110+16
 1048 015e 1B68     		ldr	r3, [r3]
 228:Src/capture.c ****     while (!DCMI_FrameIsReady && wait_ms < FRAME_TIMEOUT_MS) {
 1049              		.loc 1 228 31 view .LVU254
 1050 0160 13B9     		cbnz	r3, .L81
 228:Src/capture.c ****     while (!DCMI_FrameIsReady && wait_ms < FRAME_TIMEOUT_MS) {
 1051              		.loc 1 228 31 discriminator 1 view .LVU255
 1052 0162 B4F57A6F 		cmp	r4, #4000
 1053 0166 F5D3     		bcc	.L82
 1054              	.L81:
 233:Src/capture.c ****     if (!DCMI_FrameIsReady) {
 1055              		.loc 1 233 5 is_stmt 1 view .LVU256
 233:Src/capture.c ****     if (!DCMI_FrameIsReady) {
 1056              		.loc 1 233 9 is_stmt 0 view .LVU257
 1057 0168 554B     		ldr	r3, .L110+16
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 29


 1058 016a 1B68     		ldr	r3, [r3]
 233:Src/capture.c ****     if (!DCMI_FrameIsReady) {
 1059              		.loc 1 233 8 view .LVU258
 1060 016c 43B1     		cbz	r3, .L105
 241:Src/capture.c ****     if (HAL_DCMI_Stop(hdcmi) != HAL_OK) {
 1061              		.loc 1 241 5 is_stmt 1 view .LVU259
 241:Src/capture.c ****     if (HAL_DCMI_Stop(hdcmi) != HAL_OK) {
 1062              		.loc 1 241 9 is_stmt 0 view .LVU260
 1063 016e 2846     		mov	r0, r5
 1064 0170 FFF7FEFF 		bl	HAL_DCMI_Stop
 1065              	.LVL101:
 241:Src/capture.c ****     if (HAL_DCMI_Stop(hdcmi) != HAL_OK) {
 1066              		.loc 1 241 8 discriminator 1 view .LVU261
 1067 0174 0546     		mov	r5, r0
 1068              	.LVL102:
 241:Src/capture.c ****     if (HAL_DCMI_Stop(hdcmi) != HAL_OK) {
 1069              		.loc 1 241 8 discriminator 1 view .LVU262
 1070 0176 A8B9     		cbnz	r0, .L106
 1071              	.LBB4:
 256:Src/capture.c ****     for (uint32_t i = 0; i + 1 < JPEG_BUFFER_SIZE; i++) {
 1072              		.loc 1 256 19 view .LVU263
 1073 0178 0022     		movs	r2, #0
 1074              	.LBE4:
 253:Src/capture.c ****     uint32_t soi_pos = JPEG_BUFFER_SIZE;
 1075              		.loc 1 253 14 view .LVU264
 1076 017a 4FF4E021 		mov	r1, #458752
 1077 017e 28E0     		b	.L84
 1078              	.LVL103:
 1079              	.L105:
 234:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"Frame timeout");
 1080              		.loc 1 234 9 is_stmt 1 view .LVU265
 1081 0180 574B     		ldr	r3, .L110+48
 1082 0182 0193     		str	r3, [sp, #4]
 1083 0184 0C23     		movs	r3, #12
 1084 0186 0093     		str	r3, [sp]
 1085 0188 0523     		movs	r3, #5
 1086 018a 4B4A     		ldr	r2, .L110+8
 1087 018c 1288     		ldrh	r2, [r2]
 1088 018e 3221     		movs	r1, #50
 1089 0190 0020     		movs	r0, #0
 1090 0192 FFF7FEFF 		bl	LCD_ShowString
 1091              	.LVL104:
 235:Src/capture.c ****         HAL_DCMI_Stop(hdcmi);
 1092              		.loc 1 235 9 view .LVU266
 1093 0196 2846     		mov	r0, r5
 1094 0198 FFF7FEFF 		bl	HAL_DCMI_Stop
 1095              	.LVL105:
 236:Src/capture.c ****         f_close(&capture_file);
 1096              		.loc 1 236 9 view .LVU267
 1097 019c 04A8     		add	r0, sp, #16
 1098 019e FFF7FEFF 		bl	f_close
 1099              	.LVL106:
 237:Src/capture.c ****         return 0;
 1100              		.loc 1 237 9 view .LVU268
 237:Src/capture.c ****         return 0;
 1101              		.loc 1 237 16 is_stmt 0 view .LVU269
 1102 01a2 35E7     		b	.L74
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 30


 1103              	.LVL107:
 1104              	.L106:
 242:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"DCMI stop failed");
 1105              		.loc 1 242 9 is_stmt 1 view .LVU270
 1106 01a4 4F4B     		ldr	r3, .L110+52
 1107 01a6 0193     		str	r3, [sp, #4]
 1108 01a8 0C23     		movs	r3, #12
 1109 01aa 0093     		str	r3, [sp]
 1110 01ac 0523     		movs	r3, #5
 1111 01ae 424A     		ldr	r2, .L110+8
 1112 01b0 1288     		ldrh	r2, [r2]
 1113 01b2 3221     		movs	r1, #50
 1114 01b4 0020     		movs	r0, #0
 1115 01b6 FFF7FEFF 		bl	LCD_ShowString
 1116              	.LVL108:
 243:Src/capture.c ****         f_close(&capture_file);
 1117              		.loc 1 243 9 view .LVU271
 1118 01ba 04A8     		add	r0, sp, #16
 1119 01bc FFF7FEFF 		bl	f_close
 1120              	.LVL109:
 244:Src/capture.c ****         return 0;
 1121              		.loc 1 244 9 view .LVU272
 244:Src/capture.c ****         return 0;
 1122              		.loc 1 244 16 is_stmt 0 view .LVU273
 1123 01c0 26E7     		b	.L74
 1124              	.LVL110:
 1125              	.L109:
 1126              	.LBB5:
 258:Src/capture.c ****             jpeg_buffer[i] == 0xFF && jpeg_buffer[i+1] == 0xD8) {
 1127              		.loc 1 258 24 view .LVU274
 1128 01c2 3E48     		ldr	r0, .L110+12
 1129 01c4 805C     		ldrb	r0, [r0, r2]	@ zero_extendqisi2
 257:Src/capture.c ****         if (soi_pos == JPEG_BUFFER_SIZE && 
 1130              		.loc 1 257 41 discriminator 1 view .LVU275
 1131 01c6 FF28     		cmp	r0, #255
 1132 01c8 2BD0     		beq	.L107
 1133              	.LVL111:
 1134              	.L86:
 261:Src/capture.c ****         if (soi_pos != JPEG_BUFFER_SIZE && 
 1135              		.loc 1 261 9 is_stmt 1 view .LVU276
 261:Src/capture.c ****         if (soi_pos != JPEG_BUFFER_SIZE && 
 1136              		.loc 1 261 12 is_stmt 0 view .LVU277
 1137 01ca B1F5E02F 		cmp	r1, #458752
 1138 01ce 07D1     		bne	.L85
 1139              	.LVL112:
 1140              	.L87:
 259:Src/capture.c ****             soi_pos = i;
 1141              		.loc 1 259 21 view .LVU278
 1142 01d0 1A46     		mov	r2, r3
 1143              	.LVL113:
 1144              	.L84:
 256:Src/capture.c ****     for (uint32_t i = 0; i + 1 < JPEG_BUFFER_SIZE; i++) {
 1145              		.loc 1 256 32 is_stmt 1 discriminator 1 view .LVU279
 256:Src/capture.c ****     for (uint32_t i = 0; i + 1 < JPEG_BUFFER_SIZE; i++) {
 1146              		.loc 1 256 28 is_stmt 0 discriminator 1 view .LVU280
 1147 01d2 531C     		adds	r3, r2, #1
 256:Src/capture.c ****     for (uint32_t i = 0; i + 1 < JPEG_BUFFER_SIZE; i++) {
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 31


 1148              		.loc 1 256 32 discriminator 1 view .LVU281
 1149 01d4 B3F5E02F 		cmp	r3, #458752
 1150 01d8 29D2     		bcs	.L108
 257:Src/capture.c ****         if (soi_pos == JPEG_BUFFER_SIZE && 
 1151              		.loc 1 257 9 is_stmt 1 view .LVU282
 257:Src/capture.c ****         if (soi_pos == JPEG_BUFFER_SIZE && 
 1152              		.loc 1 257 12 is_stmt 0 view .LVU283
 1153 01da B1F5E02F 		cmp	r1, #458752
 1154 01de F0D0     		beq	.L109
 1155              	.L85:
 1156              	.LVL114:
 262:Src/capture.c ****             jpeg_buffer[i] == 0xFF && jpeg_buffer[i+1] == 0xD9) {
 1157              		.loc 1 262 24 view .LVU284
 1158 01e0 3648     		ldr	r0, .L110+12
 1159 01e2 805C     		ldrb	r0, [r0, r2]	@ zero_extendqisi2
 261:Src/capture.c ****         if (soi_pos != JPEG_BUFFER_SIZE && 
 1160              		.loc 1 261 41 discriminator 1 view .LVU285
 1161 01e4 FF28     		cmp	r0, #255
 1162 01e6 F3D1     		bne	.L87
 262:Src/capture.c ****             jpeg_buffer[i] == 0xFF && jpeg_buffer[i+1] == 0xD9) {
 1163              		.loc 1 262 50 view .LVU286
 1164 01e8 3448     		ldr	r0, .L110+12
 1165 01ea C05C     		ldrb	r0, [r0, r3]	@ zero_extendqisi2
 262:Src/capture.c ****             jpeg_buffer[i] == 0xFF && jpeg_buffer[i+1] == 0xD9) {
 1166              		.loc 1 262 36 view .LVU287
 1167 01ec D928     		cmp	r0, #217
 1168 01ee EFD1     		bne	.L87
 263:Src/capture.c ****             eoi_pos = i + 2;
 1169              		.loc 1 263 13 is_stmt 1 view .LVU288
 263:Src/capture.c ****             eoi_pos = i + 2;
 1170              		.loc 1 263 21 is_stmt 0 view .LVU289
 1171 01f0 0232     		adds	r2, r2, #2
 1172              	.LVL115:
 264:Src/capture.c ****             break;
 1173              		.loc 1 264 13 is_stmt 1 view .LVU290
 1174              	.L88:
 264:Src/capture.c ****             break;
 1175              		.loc 1 264 13 is_stmt 0 view .LVU291
 1176              	.LBE5:
 269:Src/capture.c ****     if (soi_pos == JPEG_BUFFER_SIZE || eoi_pos == JPEG_BUFFER_SIZE || eoi_pos <= soi_pos) {
 1177              		.loc 1 269 5 is_stmt 1 view .LVU292
 269:Src/capture.c ****     if (soi_pos == JPEG_BUFFER_SIZE || eoi_pos == JPEG_BUFFER_SIZE || eoi_pos <= soi_pos) {
 1178              		.loc 1 269 8 is_stmt 0 view .LVU293
 1179 01f2 B2F5E02F 		cmp	r2, #458752
 1180 01f6 18BF     		it	ne
 1181 01f8 B1F5E02F 		cmpne	r1, #458752
 1182 01fc 01D0     		beq	.L90
 269:Src/capture.c ****     if (soi_pos == JPEG_BUFFER_SIZE || eoi_pos == JPEG_BUFFER_SIZE || eoi_pos <= soi_pos) {
 1183              		.loc 1 269 68 discriminator 1 view .LVU294
 1184 01fe 9142     		cmp	r1, r2
 1185 0200 18D3     		bcc	.L91
 1186              	.L90:
 270:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"Invalid JPEG");
 1187              		.loc 1 270 9 is_stmt 1 view .LVU295
 1188 0202 394B     		ldr	r3, .L110+56
 1189              	.LVL116:
 270:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"Invalid JPEG");
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 32


 1190              		.loc 1 270 9 is_stmt 0 view .LVU296
 1191 0204 0193     		str	r3, [sp, #4]
 1192 0206 0C23     		movs	r3, #12
 1193 0208 0093     		str	r3, [sp]
 1194 020a 0523     		movs	r3, #5
 1195 020c 2A4A     		ldr	r2, .L110+8
 1196              	.LVL117:
 270:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"Invalid JPEG");
 1197              		.loc 1 270 9 view .LVU297
 1198 020e 1288     		ldrh	r2, [r2]
 1199 0210 3221     		movs	r1, #50
 1200              	.LVL118:
 270:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)"Invalid JPEG");
 1201              		.loc 1 270 9 view .LVU298
 1202 0212 0020     		movs	r0, #0
 1203 0214 FFF7FEFF 		bl	LCD_ShowString
 1204              	.LVL119:
 271:Src/capture.c ****         f_close(&capture_file);
 1205              		.loc 1 271 9 is_stmt 1 view .LVU299
 1206 0218 04A8     		add	r0, sp, #16
 1207 021a FFF7FEFF 		bl	f_close
 1208              	.LVL120:
 272:Src/capture.c ****         return 0;
 1209              		.loc 1 272 9 view .LVU300
 272:Src/capture.c ****         return 0;
 1210              		.loc 1 272 16 is_stmt 0 view .LVU301
 1211 021e 2E46     		mov	r6, r5
 1212 0220 F6E6     		b	.L74
 1213              	.LVL121:
 1214              	.L107:
 1215              	.LBB6:
 258:Src/capture.c ****             jpeg_buffer[i] == 0xFF && jpeg_buffer[i+1] == 0xD8) {
 1216              		.loc 1 258 50 view .LVU302
 1217 0222 2648     		ldr	r0, .L110+12
 1218 0224 C05C     		ldrb	r0, [r0, r3]	@ zero_extendqisi2
 258:Src/capture.c ****             jpeg_buffer[i] == 0xFF && jpeg_buffer[i+1] == 0xD8) {
 1219              		.loc 1 258 36 view .LVU303
 1220 0226 D828     		cmp	r0, #216
 1221 0228 CFD1     		bne	.L86
 259:Src/capture.c ****             soi_pos = i;
 1222              		.loc 1 259 21 view .LVU304
 1223 022a 1146     		mov	r1, r2
 1224              	.LVL122:
 259:Src/capture.c ****             soi_pos = i;
 1225              		.loc 1 259 21 view .LVU305
 1226 022c CDE7     		b	.L86
 1227              	.LVL123:
 1228              	.L108:
 259:Src/capture.c ****             soi_pos = i;
 1229              		.loc 1 259 21 view .LVU306
 1230              	.LBE6:
 254:Src/capture.c ****     uint32_t eoi_pos = JPEG_BUFFER_SIZE;
 1231              		.loc 1 254 14 view .LVU307
 1232 022e 4FF4E022 		mov	r2, #458752
 1233              	.LVL124:
 254:Src/capture.c ****     uint32_t eoi_pos = JPEG_BUFFER_SIZE;
 1234              		.loc 1 254 14 view .LVU308
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 33


 1235 0232 DEE7     		b	.L88
 1236              	.LVL125:
 1237              	.L91:
 276:Src/capture.c ****     uint32_t jpeg_size = eoi_pos - soi_pos;
 1238              		.loc 1 276 5 is_stmt 1 view .LVU309
 276:Src/capture.c ****     uint32_t jpeg_size = eoi_pos - soi_pos;
 1239              		.loc 1 276 14 is_stmt 0 view .LVU310
 1240 0234 541A     		subs	r4, r2, r1
 1241              	.LVL126:
 277:Src/capture.c ****     UINT bytes_written = 0;
 1242              		.loc 1 277 5 is_stmt 1 view .LVU311
 277:Src/capture.c ****     UINT bytes_written = 0;
 1243              		.loc 1 277 10 is_stmt 0 view .LVU312
 1244 0236 0023     		movs	r3, #0
 1245              	.LVL127:
 277:Src/capture.c ****     UINT bytes_written = 0;
 1246              		.loc 1 277 10 view .LVU313
 1247 0238 0393     		str	r3, [sp, #12]
 279:Src/capture.c ****     res = f_write(&capture_file, &jpeg_buffer[soi_pos], jpeg_size, &bytes_written);
 1248              		.loc 1 279 5 is_stmt 1 view .LVU314
 279:Src/capture.c ****     res = f_write(&capture_file, &jpeg_buffer[soi_pos], jpeg_size, &bytes_written);
 1249              		.loc 1 279 11 is_stmt 0 view .LVU315
 1250 023a 03AB     		add	r3, sp, #12
 1251 023c 2246     		mov	r2, r4
 1252              	.LVL128:
 279:Src/capture.c ****     res = f_write(&capture_file, &jpeg_buffer[soi_pos], jpeg_size, &bytes_written);
 1253              		.loc 1 279 11 view .LVU316
 1254 023e 1F48     		ldr	r0, .L110+12
 1255 0240 0144     		add	r1, r1, r0
 1256              	.LVL129:
 279:Src/capture.c ****     res = f_write(&capture_file, &jpeg_buffer[soi_pos], jpeg_size, &bytes_written);
 1257              		.loc 1 279 11 view .LVU317
 1258 0242 04A8     		add	r0, sp, #16
 1259 0244 FFF7FEFF 		bl	f_write
 1260              	.LVL130:
 280:Src/capture.c ****     if (res != FR_OK || bytes_written != jpeg_size) {
 1261              		.loc 1 280 5 is_stmt 1 view .LVU318
 280:Src/capture.c ****     if (res != FR_OK || bytes_written != jpeg_size) {
 1262              		.loc 1 280 8 is_stmt 0 view .LVU319
 1263 0248 0346     		mov	r3, r0
 1264 024a 10B9     		cbnz	r0, .L92
 280:Src/capture.c ****     if (res != FR_OK || bytes_written != jpeg_size) {
 1265              		.loc 1 280 39 discriminator 1 view .LVU320
 1266 024c 039A     		ldr	r2, [sp, #12]
 280:Src/capture.c ****     if (res != FR_OK || bytes_written != jpeg_size) {
 1267              		.loc 1 280 22 discriminator 1 view .LVU321
 1268 024e A242     		cmp	r2, r4
 1269 0250 14D0     		beq	.L93
 1270              	.L92:
 281:Src/capture.c ****         snprintf(msg, sizeof(msg), "Write err:%d", res);
 1271              		.loc 1 281 9 is_stmt 1 view .LVU322
 1272 0252 90AC     		add	r4, sp, #576
 1273              	.LVL131:
 281:Src/capture.c ****         snprintf(msg, sizeof(msg), "Write err:%d", res);
 1274              		.loc 1 281 9 is_stmt 0 view .LVU323
 1275 0254 254A     		ldr	r2, .L110+60
 1276 0256 4021     		movs	r1, #64
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 34


 1277 0258 2046     		mov	r0, r4
 1278              	.LVL132:
 281:Src/capture.c ****         snprintf(msg, sizeof(msg), "Write err:%d", res);
 1279              		.loc 1 281 9 view .LVU324
 1280 025a FFF7FEFF 		bl	snprintf
 1281              	.LVL133:
 282:Src/capture.c ****         LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)msg);
 1282              		.loc 1 282 9 is_stmt 1 view .LVU325
 1283 025e 0194     		str	r4, [sp, #4]
 1284 0260 0C23     		movs	r3, #12
 1285 0262 0093     		str	r3, [sp]
 1286 0264 0523     		movs	r3, #5
 1287 0266 144A     		ldr	r2, .L110+8
 1288 0268 1288     		ldrh	r2, [r2]
 1289 026a 3221     		movs	r1, #50
 1290 026c 0020     		movs	r0, #0
 1291 026e FFF7FEFF 		bl	LCD_ShowString
 1292              	.LVL134:
 283:Src/capture.c ****         f_close(&capture_file);
 1293              		.loc 1 283 9 view .LVU326
 1294 0272 04A8     		add	r0, sp, #16
 1295 0274 FFF7FEFF 		bl	f_close
 1296              	.LVL135:
 284:Src/capture.c ****         return 0;
 1297              		.loc 1 284 9 view .LVU327
 284:Src/capture.c ****         return 0;
 1298              		.loc 1 284 16 is_stmt 0 view .LVU328
 1299 0278 2E46     		mov	r6, r5
 1300 027a C9E6     		b	.L74
 1301              	.LVL136:
 1302              	.L93:
 288:Src/capture.c ****     f_sync(&capture_file);
 1303              		.loc 1 288 5 is_stmt 1 view .LVU329
 1304 027c 04A8     		add	r0, sp, #16
 1305              	.LVL137:
 288:Src/capture.c ****     f_sync(&capture_file);
 1306              		.loc 1 288 5 is_stmt 0 view .LVU330
 1307 027e FFF7FEFF 		bl	f_sync
 1308              	.LVL138:
 289:Src/capture.c ****     f_close(&capture_file);
 1309              		.loc 1 289 5 is_stmt 1 view .LVU331
 1310 0282 04A8     		add	r0, sp, #16
 1311 0284 FFF7FEFF 		bl	f_close
 1312              	.LVL139:
 292:Src/capture.c ****     snprintf(msg, sizeof(msg), "Saved %lu bytes", (unsigned long)bytes_written);
 1313              		.loc 1 292 5 view .LVU332
 1314 0288 90AC     		add	r4, sp, #576
 1315              	.LVL140:
 292:Src/capture.c ****     snprintf(msg, sizeof(msg), "Saved %lu bytes", (unsigned long)bytes_written);
 1316              		.loc 1 292 5 is_stmt 0 view .LVU333
 1317 028a 039B     		ldr	r3, [sp, #12]
 1318 028c 184A     		ldr	r2, .L110+64
 1319 028e 4021     		movs	r1, #64
 1320 0290 2046     		mov	r0, r4
 1321 0292 FFF7FEFF 		bl	snprintf
 1322              	.LVL141:
 293:Src/capture.c ****     LCD_ShowString(0, 50, ST7735Ctx.Width, 5, 12, (uint8_t*)msg);
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 35


 1323              		.loc 1 293 5 is_stmt 1 view .LVU334
 1324 0296 0194     		str	r4, [sp, #4]
 1325 0298 0C23     		movs	r3, #12
 1326 029a 0093     		str	r3, [sp]
 1327 029c 0523     		movs	r3, #5
 1328 029e 064A     		ldr	r2, .L110+8
 1329 02a0 1288     		ldrh	r2, [r2]
 1330 02a2 3221     		movs	r1, #50
 1331 02a4 0020     		movs	r0, #0
 1332 02a6 FFF7FEFF 		bl	LCD_ShowString
 1333              	.LVL142:
 295:Src/capture.c ****     return 1;
 1334              		.loc 1 295 5 view .LVU335
 295:Src/capture.c ****     return 1;
 1335              		.loc 1 295 12 is_stmt 0 view .LVU336
 1336 02aa 0126     		movs	r6, #1
 1337 02ac B0E6     		b	.L74
 1338              	.L111:
 1339 02ae 00BF     		.align	2
 1340              	.L110:
 1341 02b0 00000000 		.word	photo_id
 1342 02b4 14000000 		.word	.LC7
 1343 02b8 00000000 		.word	ST7735Ctx
 1344 02bc 00000000 		.word	jpeg_buffer
 1345 02c0 00000000 		.word	DCMI_FrameIsReady
 1346 02c4 00000000 		.word	DCMI_VsyncFlag
 1347 02c8 00000000 		.word	hi2c1
 1348 02cc 3C000000 		.word	.LC9
 1349 02d0 00000000 		.word	.LC6
 1350 02d4 28000000 		.word	.LC8
 1351 02d8 4C000000 		.word	.LC10
 1352 02dc 60000000 		.word	.LC11
 1353 02e0 70000000 		.word	.LC12
 1354 02e4 80000000 		.word	.LC13
 1355 02e8 94000000 		.word	.LC14
 1356 02ec A4000000 		.word	.LC15
 1357 02f0 B4000000 		.word	.LC16
 1358              		.cfi_endproc
 1359              	.LFE152:
 1361              		.section	.sram1,"aw"
 1362              		.align	2
 1365              	jpeg_buffer:
 1366 0000 00000000 		.space	458752
 1366      00000000 
 1366      00000000 
 1366      00000000 
 1366      00000000 
 1367              		.text
 1368              	.Letext0:
 1369              		.file 2 "Middlewares/Third_Party/FatFs/src/integer.h"
 1370              		.file 3 "/Applications/ArmGNUToolchain/13.3.rel1/arm-none-eabi/arm-none-eabi/include/machine/_defa
 1371              		.file 4 "/Applications/ArmGNUToolchain/13.3.rel1/arm-none-eabi/arm-none-eabi/include/sys/_stdint.h
 1372              		.file 5 "Drivers/CMSIS/Device/ST/STM32H7xx/Include/stm32h750xx.h"
 1373              		.file 6 "/Applications/ArmGNUToolchain/13.3.rel1/arm-none-eabi/lib/gcc/arm-none-eabi/13.3.1/includ
 1374              		.file 7 "Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal_def.h"
 1375              		.file 8 "Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal_dma.h"
 1376              		.file 9 "Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal_dcmi.h"
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 36


 1377              		.file 10 "Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal_i2c.h"
 1378              		.file 11 "Middlewares/Third_Party/FatFs/src/ff.h"
 1379              		.file 12 "Inc/fatfs.h"
 1380              		.file 13 "Inc/i2c.h"
 1381              		.file 14 "Drivers/BSP/ST7735/st7735.h"
 1382              		.file 15 "Drivers/BSP/ST7735/lcd.h"
 1383              		.file 16 "/Applications/ArmGNUToolchain/13.3.rel1/arm-none-eabi/arm-none-eabi/include/string.h"
 1384              		.file 17 "Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal.h"
 1385              		.file 18 "Drivers/BSP/Camera/camera.h"
 1386              		.file 19 "/Applications/ArmGNUToolchain/13.3.rel1/arm-none-eabi/arm-none-eabi/include/stdio.h"
 1387              		.file 20 "<built-in>"
ARM GAS  /var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s 			page 37


DEFINED SYMBOLS
                            *ABS*:00000000 capture.c
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:20     .text.to_lower:00000000 $t
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:25     .text.to_lower:00000000 to_lower
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:53     .rodata.ensure_sd_mounted.str1.4:00000000 $d
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:57     .text.ensure_sd_mounted:00000000 $t
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:62     .text.ensure_sd_mounted:00000000 ensure_sd_mounted
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:143    .text.ensure_sd_mounted:00000048 $d
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:152    .rodata.parse_photo_id.str1.4:00000000 $d
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:159    .text.parse_photo_id:00000000 $t
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:164    .text.parse_photo_id:00000000 parse_photo_id
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:417    .text.parse_photo_id:000000f4 $d
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:423    .rodata.find_next_photo_id.str1.4:00000000 $d
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:427    .text.find_next_photo_id:00000000 $t
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:432    .text.find_next_photo_id:00000000 find_next_photo_id
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:529    .text.find_next_photo_id:0000005c $d
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:536    .rodata.find_unused_filename.str1.4:00000000 $d
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:543    .text.find_unused_filename:00000000 $t
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:548    .text.find_unused_filename:00000000 find_unused_filename
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:710    .text.find_unused_filename:000000b0 $d
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:718    .rodata.take_A_Picture.str1.4:00000000 $d
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:752    .text.take_A_Picture:00000000 $t
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:758    .text.take_A_Picture:00000000 take_A_Picture
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:1341   .text.take_A_Picture:000002b0 $d
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:1365   .sram1:00000000 jpeg_buffer
/var/folders/mq/wg13gp494590nh4zyt09lxf00000gn/T//ccuSulQY.s:1362   .sram1:00000000 $d

UNDEFINED SYMBOLS
f_mount
snprintf
LCD_ShowString
SDFatFS
SDPath
ST7735Ctx
strrchr
strncmp
f_opendir
f_readdir
f_closedir
f_stat
f_open
memset
Camera_Picture_Device
HAL_Delay
HAL_DCMI_Start_DMA
f_close
HAL_DCMI_Stop
f_write
f_sync
photo_id
DCMI_FrameIsReady
DCMI_VsyncFlag
hi2c1
